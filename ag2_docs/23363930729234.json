{
    "id": 23363930729234,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/23363930729234.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/23363930729234-Troubleshooting-Emails-Stuck-in-Queue-Due-to-Unverified-Domain-in-SES",
    "author_id": 1904316023094,
    "comments_disabled": false,
    "draft": false,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20034388560530,
    "created_at": "2024-12-17T20:17:05Z",
    "updated_at": "2024-12-19T09:27:29Z",
    "name": "Troubleshooting: Emails Stuck in Queue Due to Unverified Domain in SES",
    "title": "Troubleshooting: Emails Stuck in Queue Due to Unverified Domain in SES",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-12-19T09:27:29Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [
        "Troubleshooting",
        "DNS",
        "Email",
        "Domain Verification",
        "SES"
    ],
    "body": "<h1 id=\"h_01JFB5J5C04V473XZ6RTARZQY1\">Overview</h1>\n<p>Customers may experience an issue where emails are not being sent from their installation and are stuck in the queue (this is a different issue from emails stuck in \"Sent\" status, not the scope of this article.</p>\n<p>This problem typically arises when the customer's domain is not verified and has been migrated to SES (Amazon Simple Email Service). The domain verification status and the email flow (whether it's using SES or old mail flow) are critical factors in this issue.</p>\n<h1 id=\"h_01JFB5J5C0NWM46TKYZCAE3F29\">Solution</h1>\n<ol>\n<li>Check if this is using SES or old mail flow:\n<ul dir=\"auto\">\n<li>Check the hurricane config key:<br><img style=\"aspect-ratio: auto;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/5PlL92AaooLAz7Drx4oP7fMR5/?name=image.png\">\n</li>\n<li>If using amazonaws value, then this is the new flow, procceed with steps below.</li>\n<li>otherwise it is using the old flow (this KB is not applicable), and you need to follow the old KB: <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21236040590994-Troubleshooting-Mail-Delivery-Issues-A-Comprehensive-Guide\" rel=\"noopener noreferrer\">Troubleshooting-Mail-Delivery-Issues-A-Comprehensive-Guide</a>\n</li>\n</ul>\n</li>\n<li>Get the sender email:\n<ul dir=\"auto\">\n<li>Check the mailing having the issue</li>\n<li>Open its Mail template</li>\n<li>Expand Advanced Mail settings</li>\n<li>Check the return Path, if is empty, or \"Return Path = From\", or alternatively having an explicit mail .</li>\n<li>If there is a return Path with an explicit mail, then this is the <strong>actual sender</strong>, if not, get the sender from the from email:<br><img style=\"aspect-ratio: auto;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/qdQ3jdwrnbFnrfgKm54kcBbsI/?name=image.png\"><br><img style=\"aspect-ratio: auto;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/1Y5sL1jhNg8n852pQlWySIeqm/?name=image.png\" width=\"347\" height=\"110\">\n</li>\n</ul>\n</li>\n<li>Once <strong>sender</strong> is confirmed, get its <strong>domain, </strong>then perform the following checks to confirm domain is verified:\n<ol dir=\"auto\">\n<li>Check if the domain should be managed by us or the customer:\n<ul dir=\"auto\">\n<li>In <a href=\"https://docs.google.com/spreadsheets/d/1CQmDPjwnJPvtZDlpL9joDMdpn_gumZaLr5QAwCxKIvw/edit?gid=121327049#gid=121327049\">this sheet</a>, check \"CombinedSenders\" tab, column \"<strong>Variomedia</strong>\", if value =<strong>Yes</strong>, then it should be managed by us, if value =<strong>No</strong>, then it should be managed by the customer.</li>\n<li>If customer claims otherwise (against the sheet), double check the domain name ownership with the contacts mentioned in <a href=\"#h_01JEEKE76EB7V597KKM9VQ1H4J\">this section</a>\n</li>\n</ul>\n</li>\n<li>Check SES account by going to the correct AWS account (us or de prod accounts on AWS according to the instance), select SES service -&gt; Identities -&gt; Search for the domain <br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/23373640751506\" width=\"495\" height=\"229\">\n</li>\n<li><img style=\"aspect-ratio: auto;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/6uvL0GiL2uvFoYf4IqaeDxaI9/?name=image.png\"></li>\n<li>If the domain is verified, then configurations are correct, customer needs to retry to send the email, or CS can generate a test email in queue to test the delivery</li>\n<li>If the domain is not found, raise a Saas CR to add it in SES, and get a confirmation if it is managed by customer or us.\n<ul dir=\"auto\">\n<li>If managed by customer, request a zone file to be shared with the customer;</li>\n<li>Otherwise Saas should make the necessary changes.</li>\n<li>Note: domain <code>bncemail.com</code> was just updated by Saas today (12/17/2024), so if you find the sender from that domain, check if the unreachable emails were sent before or after that date.</li>\n</ul>\n</li>\n<li>If the domain is \"pending\" or \"not verified\" , Check <a href=\"https://docs.google.com/spreadsheets/d/1CQmDPjwnJPvtZDlpL9joDMdpn_gumZaLr5QAwCxKIvw/edit?gid=905412533#gid=905412533\" rel=\"noopener noreferrer\">this sheet</a> and look for the domain in CustomDomainTracking sheet<br><img style=\"aspect-ratio: auto;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/HXSdWtUcX2c3Avn4gQQ10ImG6/?name=image.png\">\n<ul dir=\"auto\">\n<li>If the domain is not found in that google sheet, ping VP and raymond.guirguis to check, it should be there since on ses</li>\n<li>Assuming the domain is found, get the customer name (colomn C), and look-up the drive location of zone files from <a href=\"https://docs.google.com/spreadsheets/d/1CQmDPjwnJPvtZDlpL9joDMdpn_gumZaLr5QAwCxKIvw/edit?gid=1867633889#gid=1867633889\" rel=\"noopener noreferrer\"><strong>PerCustomerAnalysis </strong></a>tab in the same sheet.</li>\n<li>Get the zone folder location from column \"DNS zone files link\" (AC), and look for the zone file for that domain.</li>\n<li>Provide this to the customer, they NEED to update their DNS records, as otherwise everything will fail (ex: ZD <a href=\"https://central-supportdesk.zendesk.com/agent/tickets/4585554\">4585554</a>)</li>\n</ul>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"h_01JFB627EDFQ2PVXD38BZJ1F88\"><strong>Verification:</strong></h3>\n<ul>\n<li>To verify a domain is verified in SES, as mentioned above, this can be check in AWS management console<br><img style=\"aspect-ratio: auto;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/I2vVQyutH5TV2VF8JX0AUkaQ5/?name=image.png\">\n</li>\n<li>To verify the customer added a specific CNAME record, apply the following:\n<ul>\n<li>Get the expected CNAME record from the zone file (steps mentioned above to get zone file)</li>\n<li>Use command:\n<pre>nslookup -<span class=\"hljs-built_in\">type</span>=cname &lt;CNAME VALUE&gt;._domainkey.&lt;DOMAIN NAME&gt;</pre>\n</li>\n<li>A valid response would look like this:<img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/23364345816850\">\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"h_01JFB5J5C0NQSS1CG666WS0Y34\">Summary</h1>\n<p>This article provides a step-by-step guide to troubleshoot the issue of emails being stuck in the queue due to an unverified domain in SES. The solution involves checking the email flow, confirming the sender's domain, verifying the domain in SES, and updating DNS records if necessary.</p>\n<h2 id=\"h_01JFB5J5C0SFF8D1YJ1FM6KGY5\">FAQ</h2>\n<ol>\n<li>\n<strong>What do I do if the domain is not found in SES?</strong><br>Raise a Saas CR to add it in SES, and get a confirmation if it is managed by the customer or us. If by the customer, request a zone file to be shared with the customer; otherwise, Saas should make the necessary changes.</li>\n<li>\n<strong>What if the domain is 'not verified' or 'pending'?</strong><br>Check the CustomDomainTracking sheet and look for the domain. If the domain is not found in that google sheet, ping VP and raymond.guirguis to check.</li>\n<li>\n<strong>What should the customer do after updating their DNS records?</strong><br>Once the DNS records are updated, we verify the propagation using nslookup for all the entries. If those are propagated, we can access AWS and check if the domain is verified ourselves.</li>\n</ol>",
    "user_segment_ids": [
        360000084973
    ]
}