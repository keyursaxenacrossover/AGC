{
    "id": 20426284826642,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/20426284826642.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20426284826642-The-world-of-DNS-Email-SSL-Certificates-and-how-it-relates-to-EFS",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": false,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20234751255186,
    "created_at": "2024-07-29T09:10:03Z",
    "updated_at": "2024-08-07T10:39:39Z",
    "name": "The world of DNS, Email, SSL Certificates and how it relates to EFS",
    "title": "The world of DNS, Email, SSL Certificates and how it relates to EFS",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-08-07T10:39:35Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<h2 id=\"h_01J3YW549F6N6YAFCYJGTJBBR7\">Table of Contents</h2>\n<ul>\n<li>\n<a href=\"#dns-concepts\">DNS Concepts</a>\n<ul>\n<li>\n<a href=\"#domain-types\">Domain types</a>\n<ul>\n<li><a href=\"#apex-domain-zone-apex-2nd-level-domans\">Apex-Domain / Zone-Apex / 2nd-level-Domans</a></li>\n<li><a href=\"#sub-domains\">Sub-Domains</a></li>\n</ul>\n</li>\n<li>\n<a href=\"#dsn-record-types\">DNS Record Types</a>\n<ul>\n<li><a href=\"#a-aaaa\">A / AAAA</a></li>\n<li><a href=\"#mx\">MX</a></li>\n<li><a href=\"#cname\">CNAME</a></li>\n<li><a href=\"#txt\">TXT</a></li>\n<li><a href=\"#ns\">NS</a></li>\n<li><a href=\"#alias-aname-cname-flattening-non-standard-virtual-record\">ALIAS / ANAME / CNAME Flattening (non-standard / virtual-record)</a></li>\n<li><a href=\"#caa\">CAA</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<a href=\"#email-concepts\">Email Concepts</a>\n<ul>\n<li><a href=\"#mx-record-sending-only\">MX-Record ; sending-only</a></li>\n<li>\n<a href=\"#spf-sender-policy-framework-sometimes-called-spf-records-receiving-validation-only\">SPF - Sender Policy Framework (sometimes called SPF-Records) ; receiving-validation only</a>\n<ul>\n<li><a href=\"#identification-of-domain-to-be-checked\">Identification of domain to be checked</a></li>\n<li><a href=\"#lookup-and-verification\">Lookup and verification</a></li>\n<li><a href=\"#structure-contents-of-the-spf-record\">Structure / contents of the SPF-Record</a></li>\n<li><a href=\"#pitfalls-and-other-noteworthy-stuff\">Pitfalls and other noteworthy stuff</a></li>\n<li><a href=\"#further-reading\">Further reading</a></li>\n</ul>\n</li>\n<li>\n<a href=\"#dkim-domainkeys-identified-mail-sending-receiving-validation\">DKIM - DomainKeys Identified Mail ; sending &amp; receiving-validation</a>\n<ul>\n<li><a href=\"#computation-and-appendment-of-the-dkim-signature\">Computation and appendment of the DKIM-Signature</a></li>\n<li><a href=\"#validation-stage\">Validation Stage</a></li>\n<li><a href=\"#further-reading-1\">Further reading</a></li>\n</ul>\n</li>\n<li>\n<a href=\"#dmarc-domain-based-message-authentication-reporting-and-conformance-receiving-validation-only\">DMARC - Domain-based Message Authentication, Reporting and Conformance ; receiving-validation only</a>\n<ul>\n<li><a href=\"#prevents-abuse-in-from-field-by-spammers\">Prevents abuse in “From” field by spammers</a></li>\n<li><a href=\"#reporting-how-and-what\">Reporting how and what</a></li>\n<li><a href=\"#how-to-implement\">How to implement</a></li>\n<li><a href=\"#problems-limitations\">Problems / Limitations</a></li>\n<li><a href=\"#further-reading-2\">Further reading</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<a href=\"#certificate-concepts\">Certificate Concepts</a>\n<ul>\n<li>\n<a href=\"#caa-record-sending-only\">CAA-Record ; sending-only</a>\n<ul>\n<li><a href=\"#details-about-the-dns-record\">Details about the DNS-Record</a></li>\n<li><a href=\"#how-are-existing-caa-records-used-a-caa-when-issuing\">How are existing CAA Records used a CAA when issuing</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<a href=\"#dns-and-email-in-efs-how-to-pitfalls\">DNS and Email in EFS (How-to / Pitfalls)</a>\n<ul>\n<li>\n<a href=\"#recommended-efs-alias-domain-dns-records-directly-pointing-to-efs\">Recommended EFS-Alias-Domain DNS-Records directly pointing to EFS</a>\n<ul>\n<li><a href=\"#ip-related-entries-for-apex-domain-incl-www-subdomain\">IP-Related entries - For Apex-Domain incl. www-Subdomain</a></li>\n<li><a href=\"#ip-related-entries-for-sub-domain-only\">IP-Related entries - For Sub-Domain only</a></li>\n<li><a href=\"#mail-related-entries\">Mail-related entries</a></li>\n<li><a href=\"#optional-certificate-related-entries\">(optional) Certificate-related entries</a></li>\n<li><a href=\"#special-case-domain-will-point-to-cdn-e-g-akamai-waf-e-g-cloudflare\">Special case: Domain will point to CDN (e.g. Akamai) / WAF (e.g. Cloudflare)</a></li>\n<li><a href=\"#special-case-technical-domain-is-akamized\">Special case: Technical domain is Akamized</a></li>\n</ul>\n</li>\n<li>\n<a href=\"#how-to-match-recommended-record-setup-as-close-as-possible-for-customer-managed-domain\">How to match recommended Record-Setup as close as possible for customer managed domain</a>\n<ul>\n<li><a href=\"#alias-aname-record-cname-flattening\">ALIAS- / ANAME-Record / CNAME Flattening</a></li>\n<li><a href=\"#ns-record\">NS-Record</a></li>\n<li><a href=\"#cname-record-only-for-sub-domains\">CNAME-Record (Only for Sub-Domains)</a></li>\n<li><a href=\"#domain-transfer\">Domain-Transfer</a></li>\n</ul>\n</li>\n<li>\n<a href=\"#customer-handover-templates\">Customer Handover Templates</a>\n<ul>\n<li><a href=\"#for-apex-domains-incl-www-subdomain-not-if-akamai-is-in-the-mix\">For Apex-Domains (incl. www-Subdomain) (NOT: if Akamai is in the Mix!)</a></li>\n<li><a href=\"#for-subdomains-not-if-akamai-is-in-the-mix\">For Subdomains (NOT: if Akamai is in the Mix!)</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<a href=\"#examples-for-currently-supported-dns-chains-if-customer-dns-does-not-support-alias-records\">Examples for currently supported DNS Chains if customer DNS does not support ALIAS records</a>\n<ul>\n<li><a href=\"#apex-domains\">Apex Domains</a></li>\n<li>\n<a href=\"#sub-domains-1\">Sub Domains</a>\n<ul>\n<li><a href=\"#sub-domains-without-support-for-additional-records\">Sub Domains - Without support for additional records</a></li>\n<li><a href=\"#sub-domains-with-support-for-additional-records\">Sub Domains - WITH support for additional records</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"dns-concepts\">DNS Concepts</h2>\n<p>For a more detailed explanation regarding DNS, look at <a href=\"https://en.wikipedia.org/wiki/Domain_Name_System\">https://en.wikipedia.org/wiki/Domain_Name_System</a> / the corresponding RFCs.</p>\n<p>Relevant in this case is that DNS can be understood as sort of analogous to a telephone-book in which <strong>DNS-Records</strong> that have been deposited for <strong>domains</strong> can be looked and are organized in a hierarchical fashion.</p>\n<h3 id=\"domain-types\">Domain-types</h3>\n<p>Domains can be broadly classified as one 2 categories which limits the kind of DNS-Records that can be deposited for them.</p>\n<h4 id=\"apex-domain-zone-apex-2nd-level-domans\">Apex-Domain / Zone-Apex / 2nd level Domans</h4>\n<pre><code class=\"language-text\">example.com\nstuff.org\nthings.net\nmore.io\nsomething-different.co.uk</code></pre>\n<p>There are domains that can actually registered via a domain registrar, e.g. above.</p>\n<h4 id=\"sub-domains\">Sub-Domains</h4>\n<pre><code class=\"language-text\">test.example.com\nanother.test.example.com\nmore.stuff.org</code></pre>\n<p>This is any domain situated hierarchically below an Apex-Domain, e.g. above.</p>\n<h3 id=\"dsn-record-types\">DNS Record Types</h3>\n<p>The following only describes a limited number of Record Types, see <a href=\"https://en.wikipedia.org/wiki/List_of_DNS_record_types\">https://en.wikipedia.org/wiki/List_of_DNS_record_types</a> for a more exhaustive list.</p>\n<h4 id=\"a-aaaa\">A / AAAA</h4>\n<p>This record is used for depositing an IPv4 / IPv6 respectively and is usually used for IP-Resolution when browsing websites.</p>\n<p>The value of such a record will contain only the IP in the corresponding format:</p>\n<pre><code class=\"language-text\">example.com IN A 192.168.4.2\nexample.com IN AAAA c70c:3973:f12e:de58:3398:9d3a:5b07:6d20</code></pre>\n<h4 id=\"mx\">MX</h4>\n<p>This record pertains to the shipping of emails and denotes one or more servers that are responsible for receiving Email for this domain.</p>\n<p>The value of such a record contains 2 parts (see example below):</p>\n<ol start=\"1\">\n<li>\n<p>Priority value: lover value → higher priority</p>\n</li>\n<li>\n<p>Host-Name: This must resolve to an IP (A- / AAAA-Record) and <strong>never</strong> a CNAME-Record</p>\n</li>\n</ol>\n<pre><code class=\"language-text\">example.com IN MX 10 mail.example.com.\nexample.com IN MX 20 other-mail.example.com.</code></pre>\n<h4 id=\"cname\">CNAME</h4>\n<p>This records maps the respective domain to another (Then canonical one). It must <strong>never </strong>be used on an Apex-Domain.</p>\n<p>In practice when a domain-query resolves to a CNAME, the query is then restarted against the denoted “canonical” domain and that result is returned instead. The only exception is when querying for a CNAME record, in which case the actual record showing the deposited “canonical” domain is returned.</p>\n<p>The value of such a record will contain only the “canonical” domain, e.g. :</p>\n<pre><code class=\"language-text\">some.example.com IN CNAME example.com.\nanother.example.com IN CNAME 10 another.example.org.</code></pre>\n<h4 id=\"txt\">TXT</h4>\n<p>This record allows for arbitrary text to be associated with a domain and there may be one or more such records deposited for a single domain, depending on the implementation of the DNS-Server.</p>\n<p>In practice this is mainly, but not exclusively, used for SSL-DNS-Challenges and a number of Email-related standards each with their own specifications on how the contents of the record need to be structured.</p>\n<p>The value of such a record will contain the intended string wrapped in <strong>“</strong>, e.g.</p>\n<pre><code class=\"language-text\">some.example.com IN TXT \"this is some text\"\nsome.example.com IN TXT \"v=spf1 mx -all\"</code></pre>\n<h4 id=\"ns\">NS</h4>\n<p>This record allows the domain-administrator to specify the Name-Server against which DNS-Queries of the domain should be executed. This can be used to transfer the administrative control over the DNS-Records to another party without having to transfer the whole domain ownership.</p>\n<p>These exist on any domain and per default will point to the name server of the DNS provider at which the domain is registered. If set on a subdomain it will behave similar to a CNAME-Record but instead of pointing to an existing domain, the target domain has be recreated at the Target-Nameserver.</p>\n<p>The value of such a record will contain the Hostname of the Target-Nameserver, e.g.</p>\n<pre><code class=\"language-text\">example.com IN NS some.name-server.io\nanother.example.com IN NS another.name-server.com</code></pre>\n<h4 id=\"alias-aname-cname-flattening-non-standard-virtual-record\">ALIAS / ANAME / CNAME Flattening (non-standard / virtual-record)</h4>\n<p>This record combines the benefits of both a CNAME and an A- / AAAA-Record and is mainly used for, but not limited to, pointing an Apex-Domain to a CDN (Content Delivery Network) or a high available load-balanced setup in AWS.</p>\n<p>It is non-standard, meaning there is now official RFC for this (yet), and virtual, meaning that it appears in configuration only and is being presented as a A- / AAAA-Record instead when queried. Also due to it being non-standard there is no official name for it, but it is often called either “ALIAS” or “ANAME” inside the configuration-interface of a DNS-Provider that supports it.</p>\n<p>A provider implementing this kind of record, does so by involving a resolving name-server when answering a DNS-Query to get the A- / AAAA-Records of the deposited FQDN, which are then returned in kind (see image below). In practice some form of caching mechanisms are probably also used to prevent DoS-Attacks.</p>\n<p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20426306359314\" alt=\"image-20200302-135557.png\"></p>\n<p>The value of such a record will contain only the FQDN, e.g.</p>\n<pre><code class=\"language-text\">given:\nexample.com IN A 192.168.4.2\n\nexamples:\n\nexample.org IN ALIAS example.com.\nsome.example.org IN ANAME example.com.\nmore.example.org IN Flattened-CNAME example.com.\n\nexample.net IN ANAME example.com.\nanother.example.net IN ALIAS example.com.\nadditional.example.net IN Flattened-CNAME example.com.</code></pre>\n<p>External reference of Providers that are known to support this:</p>\n<ul>\n<li>\n<p><a href=\"https://dnsmadeeasy.com/services/anamerecords/\">https://dnsmadeeasy.com/services/anamerecords/</a></p>\n</li>\n<li>\n<p><a href=\"https://www.variomedia.de/faq/Was-sind-ALIAS-Eintraege-und-wie-funktionieren-sie/article/319\">https://www.variomedia.de/faq/Was-sind-ALIAS-Eintraege-und-wie-funktionieren-sie/article/319</a></p>\n</li>\n<li>\n<p><a href=\"https://support.dnsimple.com/articles/alias-record/\">https://support.dnsimple.com/articles/alias-record/</a></p>\n</li>\n<li>\n<p><a href=\"https://blog.cloudflare.com/introducing-cname-flattening-rfc-compliant-cnames-at-a-domains-root/\">https://blog.cloudflare.com/introducing-cname-flattening-rfc-compliant-cnames-at-a-domains-root/</a></p>\n</li>\n</ul>\n<p>Further reading:</p>\n<ul>\n<li>\n<p><a href=\"https://tools.ietf.org/id/draft-ietf-dnsop-aname-02.html\">https://tools.ietf.org/id/draft-ietf-dnsop-aname-02.html</a></p>\n</li>\n</ul>\n<h4 id=\"caa\">CAA</h4>\n<p>Also known as the <strong>Certification Authority Authorization</strong> DNS-Record is intended to provide insight / authorization in issuing Certificates and was specified in <a href=\"https://datatracker.ietf.org/doc/html/rfc8659\">RFC 8659</a>.<br>The basic idea is that a Certificat Authory e.g like <a href=\"https://letsencrypt.org/\" data-card-appearance=\"inline\">https://letsencrypt.org/</a> which we are using in our productive cloud clusters, has to check for the existince of a CAA record first, before proceeding with issueing a certificate.</p>\n<p>Also important to note is, that a CAA Record not only applies domain it sits on, but also “further down the tree”. So if <a href=\"http://some.example.com\">some.example.com</a> does NOT have a CAA record but <a href=\"http://example.com\">example.com</a> has, those Records to apply to <a href=\"http://some.example.com\">some.example.com</a> as well when trying to get a certificate issued for it.</p>\n<pre><code class=\"language-text\">some.example.com IN CAA 0 issue \"letsencrypt.org\"\nexample.com IN CAA 0 issuewild \"letsencrypt.org\"\nexample.com IN CAA 0 iodef \"mailto:some-domain@example.com\"</code></pre>\n<h2 id=\"email-concepts\">Email Concepts</h2>\n<p>The following is non exhaustive and meant as a pointer for the more commonly used concepts in regards to sending and the validation of receiving emails. The later ones are intended as a means limiting / counteracting the occurrence of spam and phishing-mail.</p>\n<h3 id=\"mx-record-sending-only\">MX Record</h3>\n<p>The MX DNS Record is the most central concept when sending email. It is used by the sending mail-server to identify the destination server where an Email should be delivered to.</p>\n<p>In theory the presence of a MX Record is not mandatory, as in absence one will be amused with a Priority of “0” and the host being the domain itself. Meaning in that case the sending mail-server will try to deliver it to the IP, as noted in the A- / AAAA-Record.</p>\n<p>Also the record is used for sending mail only, so general consensus is that it has no impact on receiving end. Especially as it is not required for the sending mail-server to be mentioned inside a valid MX-Record. Nevertheless it should be noted that it may still be adversary towards successful mail delivery if one such record exists but does not resolve properly (typo in the record itself / the reference host).</p>\n<h3 id=\"spf-sender-policy-framework-sometimes-called-spf-records-receiving-validation-only\">SPF - Sender Policy Framework (sometimes called SPF-Records) ; receiving-validation only</h3>\n<p>The basic idea behind SPF that a domain owner should be able to publish a list of authorized IPs from which Emails should originate from. Thus enabling receiving mail-servers to identify if a mail originates from a non-verified source, which might be an indicator for it being SPAM.</p>\n<p>See also: <a href=\"https://postmarkapp.com/guides/spf\">Explanation of the overall SPF process</a></p>\n<h4 id=\"identification-of-domain-to-be-checked\">Identification of domain to be checked</h4>\n<p>Please not that SPF, in opposition to it’s expected behavior, usually do not check the From-Field, as shown in many mail clients. Instead it checks the Return-Path.</p>\n<p>The Return-Path-Field inside the mail header (sometimes referenced as SMTP-MAIL-FROM or envelope sender), must be set by the SMTP-server making the “final” delivery. It’s main function is for denoting the address to which information regarding Email-Bounce should be sent.</p>\n<p>Said address is then split at the '@' with the second part being for the verification.</p>\n<h4 id=\"lookup-and-verification\">Lookup and verification</h4>\n<p>After the receiving mail server has identified domain, as mention previously, it then queries said domain for it’s TXT records, searching for something like what is depicted on the right (also called SPF-Record).</p>\n<p>It then executes validation per the rules specified in said record against the IP of the sending Mail-Server, resulting in one of the following:</p>\n<ul>\n<li>\n<p><strong>None: </strong>Either the identified domain is not valid or the domain has no TXT record configured regarding SPF</p>\n</li>\n<li>\n<p><strong>Neutral: </strong>The Domain-Administrator does not explicitly assert whether the Sender-IP is authorized or not</p>\n</li>\n<li>\n<p><strong>Pass: </strong>The Sender-IP has been explicitly authorized by the Domain-Administrator.</p>\n</li>\n<li>\n<p><strong>Fail: </strong>The Domain-Administrator specifically states that the Sender-IP is not authorized.</p>\n</li>\n<li>\n<p><strong>Softfail: </strong>The Sender-IP probably is not authorized, but not explicit stated as such by the Domain-Administrator resulting in this “weak” statement. Sometimes also referenced / used as a “Testing-Mode”.</p>\n</li>\n<li>\n<p><strong>Temperror: </strong>The SPF-verification encountered a transient error (generally caused by the DNS lookup. A later retry might succeed without further intervention.</p>\n</li>\n<li>\n<p><strong>Permerror: </strong>The published SPF-Record is in itself invalid and required intervention by the Domain-Administrator to be fixed.</p>\n</li>\n</ul>\n<h4 id=\"structure-contents-of-the-spf-record\">Structure / contents of the SPF-Record</h4>\n<p>As shown before, an SPF-Record declares a number of mechanisms (at least 1) which are to be evaluated during SPF-Validation.</p>\n<p>They are processed from left to right, where each mechanism may result in either a “match”, “not-match” or return an exception:</p>\n<ul>\n<li>\n<p>“<strong>match</strong>” will stop evaluation and set the over-all validation result based on the noted qualifier to either: Pass (“+”), Fail (“-”), Softfail (“~”) or Neutral (“?”). In case no qualifier is provided, the qualifier “+” is asumed.</p>\n</li>\n<li>\n<p>“<strong>not-match</strong>” will continue the evaluation with the next mechanism in line. If no further mechanism is present, the overall evaluation result will be “Neutral” (There something like ”-all” should be last).</p>\n</li>\n<li>\n<p>If the qualifier produces an <strong>exception</strong>, evaluation will stop with the exception value being returned as the over all evaluation result.</p>\n</li>\n</ul>\n<p>See also: <a href=\"https://postmarkapp.com/blog/explaining-spf\">Explaining the structure of a TXT-Record, what mechanisms are available and how they work</a></p>\n<h4 id=\"pitfalls-and-other-noteworthy-stuff\">Pitfalls and other noteworthy stuff</h4>\n<p>There exists a global DNS-lookup limit for <strong>10 Lookups</strong> during SPF-validation, which results in a ‘Permerror’ if violated. All mechanisms except ‘ip4’, ‘ip6’ and ‘all’ as well as the ‘exp’ modifier result in such a lookup.</p>\n<p>When processing an <strong>include-</strong>statement the Sender-IP is validated against the SPF-Record of the domain provided, opposed to it’s naming. So it actually does not directly affect the result of the original Domain-Target. Instead said validation result is mapped to one of the known results of “match” (in case of “pass”), “not match” (in case of “fail”, “softfail”, “neutral” or a corresponding “exception” (in case of occurred exceptions or “none”), which are processed like any other mechanism.</p>\n<h4 id=\"further-reading\">Further reading</h4>\n<ul>\n<li>\n<p>Verification-Tool: <a href=\"https://www.mail-tester.com/spf-dkim-check\">https://www.mail-tester.com/spf-dkim-check</a></p>\n</li>\n</ul>\n<h3 id=\"dkim-domainkeys-identified-mail-sending-receiving-validation\">DKIM - DomainKeys Identified Mail (sending &amp; receiving-validation)</h3>\n<p>The idea behind DKIM is to enable the detection of in-transit email-manipulation to a point.</p>\n<p>It is a two stage process:</p>\n<ol start=\"1\">\n<li>\n<p>Computation and appendment of the DKIM-Signature by the Sending-Mail-Server</p>\n</li>\n<li>\n<p>Validating the mail based on the attached signature</p>\n</li>\n</ol>\n<h4 id=\"computation-and-appendment-of-the-dkim-signature\">Computation and appendment of the DKIM-Signature</h4>\n<p>This requires an existing Key-Pair of a public and a matching private key and is usually build into the software of the sending-mail-server.</p>\n<p>To generate the DKIM-Signature 2 hashes are computed:</p>\n<ol start=\"1\">\n<li>\n<p>Over a canonicalized version of the message body</p>\n</li>\n<li>\n<p>Over a canonicalized version of selected Email-Header fields</p>\n</li>\n</ol>\n<p>Each of the hashes is then signed with the previously mentioned Private-Key before being included into the DKIM-Signature together with any additional info needed for verification, noteworthy being:</p>\n<ul>\n<li>\n<p>The domain at which to look for the Public-Key (Tag: d)</p>\n</li>\n<li>\n<p>The selector to be used when looking up the Public-Key at the specified domain (Tag: s)</p>\n</li>\n</ul>\n<p>For additional info: <a href=\"http://dkim.org/specs/rfc4871-dkimbase.html#dkim-sig-hdr\">http://dkim.org/specs/rfc4871-dkimbase.html#dkim-sig-hdr</a></p>\n<h4 id=\"validation-stage\">Validation Stage</h4>\n<p>This happens when the receiving Mail-Server finds a DKIM-Signature attached to an incomming mail.</p>\n<p>It then uses the values of the Tags <code>d</code> and <code>s</code> to construct a domain from which the corresponding public key should be queried.</p>\n<pre><code class=\"language-text\">e.g<br>d=example.com<br>s=qb<br>=&gt; qb._domainkey.example.com</code></pre>\n<p>Therefore the Domain-Administrator must create a record at that domain, like</p>\n<pre><code class=\"language-text\">qb._domainkey.example.com IN TXT 'v=DKIM1; k=rsa; p=&lt;public-key&gt;'</code></pre>\n<p>For additional info: <a href=\"http://dkim.org/specs/rfc4871-dkimbase.html#keys\">http://dkim.org/specs/rfc4871-dkimbase.html#keys</a></p>\n<p>Additionally the two hashes, as mentioned above, will be computed again so they can be checked against the respective signed values utilizing the retrieved public key.</p>\n<h4 id=\"further-reading-1\">Further reading</h4>\n<ul>\n<li>\n<p><a href=\"https://postmarkapp.com/guides/dkim\">https://postmarkapp.com/guides/dkim</a></p>\n</li>\n<li>\n<p>Verification-Tool: <a href=\"https://www.mail-tester.com/spf-dkim-check\">https://www.mail-tester.com/spf-dkim-check</a></p>\n</li>\n</ul>\n<h3 id=\"dmarc-domain-based-message-authentication-reporting-and-conformance-receiving-validation-only\">DMARC - Domain-based Message Authentication, Reporting and Conformance ; receiving-validation only</h3>\n<p>DMARC works further to prevent a domain from being abused by spammers and also intents to increase visability for such abuses by putting in place a reporting workflow.</p>\n<p>It especially focuses on the the gap left by both SPF and DKIM, where as it is still possible to forge the “From”-Address-Field of an Email whilst still conforming to both.</p>\n<p>Opposed to SPF and DKMI, who merely give an indication towards the validity of an Email only, DMARC gives the domainowner more control over how offending mails should be handled by the recieving mail-server. To be more specific one of 3 policys can be configured:</p>\n<ul>\n<li>\n<p>Approve (<code>p=none</code>): No action should be taken and the offenses should only be reported</p>\n</li>\n<li>\n<p>Quarantine (<code>p=quarantine</code>): The offending mail should be marked as SPAM.</p>\n</li>\n<li>\n<p>Reject (<code>p=reject</code>): The offending mail should be outright rejected and not processed further.</p>\n</li>\n</ul>\n<h4 id=\"prevents-abuse-in-from-field-by-spammers\">Prevents abuse in “From” field by spammers</h4>\n<p>To achieve this more or less relies upon the result of both SPF and DKIM, but only <strong>after </strong>the “alignment” between the Address of the “From”-Field and the Return-Path (SPF) and the Signature-Domain (DKIM) has been ensured.</p>\n<p>For both SKF and DKIM, “alignment” can be specified as one of the following:</p>\n<ul>\n<li>\n<p><strong>strict</strong></p>\n<ul>\n<li>\n<p>The domains match exactly</p>\n</li>\n<li>\n<p><code>aspf=s</code> / <code>adkim=s</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>relaxed</strong></p>\n<ul>\n<li>\n<p>The match may only be partial, so a Sub-Domain would also “align” with an Apex-Domain</p>\n</li>\n<li>\n<p><code>aspf=r</code> / <code>adkim=r</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<p>Any Email domain where the domain does not match as specified or where the respective SPF / DKIM does not succeed, will fail the “alignment”-Check and will therefore be handled as specified by the DMARC-policy.</p>\n<h4 id=\"reporting-how-and-what\">Reporting how and what</h4>\n<p>If an the recieving mail-server-provider that supports DMARC will also generate reports on the activity it observes for the domain.</p>\n<p>This report are in the form of XML-files containings the amongst others the sending-source (domain/IP) as well as the info whether SPF and DKIM passed or failed.</p>\n<p>An example would be the following:</p>\n<pre><code class=\"language-xml\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;feedback&gt;\n  &lt;report_metadata&gt;\n    &lt;org_name&gt;{{Some-Organization,e.g.=google.com}}&lt;/org_name&gt;\n    &lt;email&gt;{{Reply-Mail-Address-May-Be-A--No-Reply,e.g.=noreply-dmarc-support@google.com}&lt;/email&gt;\n    &lt;extra_contact_info&gt;{{An-url-with-additional-info,e.g.=http://support.google.com/a/bin/answer.py?answer=2466580}&lt;/extra_contact_info&gt;\n    &lt;report_id&gt;{{Some-ID}}&lt;/report_id&gt;\n    &lt;date_range&gt;\n      &lt;begin&gt;{{Report-Timeframe-Start}}&lt;/begin&gt;\n      &lt;end&gt;{{Report-Timeframe-Start}}&lt;/end&gt;\n    &lt;/date_range&gt;\n  &lt;/report_metadata&gt;\n  &lt;policy_published&gt;\n    &lt;domain&gt;{{Domain-in-question}}&lt;/domain&gt;\n    &lt;adkim&gt;{{configured-DKIM-alignment-policy}}&lt;/adkim&gt;\n    &lt;aspf&gt;{{configured-SPF-alignment-policy}}&lt;/aspf&gt;\n    &lt;p&gt;{{configured-action-policy}}&lt;/p&gt;\n    &lt;sp&gt;{{configured-action-policy-for-subdomain}}&lt;/sp&gt;\n    &lt;pct&gt;{{configured-apply-percentage}}&lt;/pct&gt;\n  &lt;/policy_published&gt;\n  &lt;record&gt;\n    &lt;row&gt;\n      &lt;source_ip&gt;50.31.170.29&lt;/source_ip&gt;\n      &lt;count&gt;1&lt;/count&gt;\n      &lt;policy_evaluated&gt;\n        &lt;disposition&gt;none&lt;/disposition&gt;\n        &lt;dkim&gt;fail&lt;/dkim&gt;\n        &lt;spf&gt;fail&lt;/spf&gt;\n      &lt;/policy_evaluated&gt;\n    &lt;/row&gt;\n    &lt;identifiers&gt;\n      &lt;header_from&gt;example.com&lt;/header_from&gt;\n    &lt;/identifiers&gt;\n    &lt;auth_results&gt;\n      &lt;spf&gt;\n        &lt;domain&gt;ord-staging2.mtasv.net&lt;/domain&gt;\n        &lt;result&gt;pass&lt;/result&gt;\n      &lt;/spf&gt;\n    &lt;/auth_results&gt;\n  &lt;/record&gt;\n  &lt;record&gt;\n    &lt;row&gt;\n      &lt;source_ip&gt;50.31.156.116&lt;/source_ip&gt;\n      &lt;count&gt;2&lt;/count&gt;\n      &lt;policy_evaluated&gt;\n        &lt;disposition&gt;none&lt;/disposition&gt;\n        &lt;dkim&gt;pass&lt;/dkim&gt;\n        &lt;spf&gt;fail&lt;/spf&gt;\n      &lt;/policy_evaluated&gt;\n    &lt;/row&gt;\n    &lt;identifiers&gt;\n      &lt;header_from&gt;example.com&lt;/header_from&gt;\n    &lt;/identifiers&gt;\n    &lt;auth_results&gt;\n      &lt;dkim&gt;\n        &lt;domain&gt;example.com&lt;/domain&gt;\n        &lt;result&gt;pass&lt;/result&gt;\n      &lt;/dkim&gt;\n      &lt;spf&gt;\n        &lt;domain&gt;pm.mtasv.net&lt;/domain&gt;\n        &lt;result&gt;pass&lt;/result&gt;\n      &lt;/spf&gt;\n    &lt;/auth_results&gt;\n  &lt;/record&gt;\n  &lt;record&gt;\n    &lt;row&gt;\n      &lt;source_ip&gt;50.31.156.118&lt;/source_ip&gt;\n      &lt;count&gt;2&lt;/count&gt;\n      &lt;policy_evaluated&gt;\n        &lt;disposition&gt;none&lt;/disposition&gt;\n        &lt;dkim&gt;pass&lt;/dkim&gt;\n        &lt;spf&gt;fail&lt;/spf&gt;\n      &lt;/policy_evaluated&gt;\n    &lt;/row&gt;\n    &lt;identifiers&gt;\n      &lt;header_from&gt;example.com&lt;/header_from&gt;\n    &lt;/identifiers&gt;\n    &lt;auth_results&gt;\n      &lt;dkim&gt;\n        &lt;domain&gt;example.com&lt;/domain&gt;\n        &lt;result&gt;pass&lt;/result&gt;\n      &lt;/dkim&gt;\n      &lt;spf&gt;\n        &lt;domain&gt;pm.mtasv.net&lt;/domain&gt;\n        &lt;result&gt;pass&lt;/result&gt;\n      &lt;/spf&gt;\n    &lt;/auth_results&gt;\n  &lt;/record&gt;\n&lt;/feedback&gt;</code></pre>\n<h4 id=\"how-to-implement\">How to implement</h4>\n<p>This is implemented with a DNS-Record like:</p>\n<pre><code class=\"language-text\">_dmarc.&lt;domain-in-question&gt; IN TXT \"v=DMARC1; p=&lt;policy&gt;; [pct=&lt;percentage&gt;;] [aspf=&lt;spf-alignment&gt;;] [adkim=&lt;dkim-alignment&gt;;] [rua=&lt;reporting-mail-address&gt;;\"] [...]</code></pre>\n<ul>\n<li>\n<p>policy</p>\n<ul>\n<li>\n<p>One of ‘none’, ‘quarantine’, ‘reject’ (see above)</p>\n</li>\n</ul>\n</li>\n<li>\n<p>percentage</p>\n<ul>\n<li>\n<p>Any value less that 100 will result in only a matching portion of the over all recieved mails being filtered according to the policy. Reporting will still happen for all.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>spf-/ dkim-alignment</p>\n<ul>\n<li>\n<p>One of ‘r', 's’ (see above)</p>\n</li>\n</ul>\n</li>\n<li>\n<p>reporting-mail-address</p>\n<ul>\n<li>\n<p>The recieveing mail-adress</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>If the reports should be sent to a Mail-Address with a different Apex-Domain, then this has to be explicity whitelisted as to prevent any misuse like a (DOS-Attack). This is achieved by an additional DNS-Record at a Sub-Domain of the Apex-Domain of the the recieving mail-Adress-Host.</p>\n<pre><code class=\"language-text\">&lt;domain-with-the-configured-reporting-adress&gt;._report._dmarc.&lt;apex-of-recieveing-mail-adress-host&gt; IN TXT \"v=DMARC1\"</code></pre>\n<p><em>For example:</em></p>\n<p>If there is exists the following DMARC-Record:</p>\n<pre><code class=\"language-text\">_dmarc.some.example.com IN TXT \"v=DMARC1; p=reject; pct=100; aspf=s; adkim=s; rua=mailto:dmarc-reporting@example.net;\"</code></pre>\n<p>Then the following record has to be put in place for the reports to be send sucessfully:</p>\n<pre><code class=\"language-text\">some.example.com._report._dmarc.example.net IN TXT \"v=DMARC1\"</code></pre>\n<h4 id=\"problems-limitations\">Problems / Limitations</h4>\n<h4 id=\"further-reading-2\">Further reading</h4>\n<ul>\n<li>\n<p><a href=\"https://postmarkapp.com/guides/dmarc\">https://postmarkapp.com/guides/dmarc</a></p>\n</li>\n<li>\n<p><a href=\"https://www.dmarcanalyzer.com/how-to-create-a-dmarc-record/\">https://www.dmarcanalyzer.com/how-to-create-a-dmarc-record/</a></p>\n</li>\n<li>\n<p><a href=\"https://www.vircom.com/blog/a-critique-what-is-dmarc-missing/\">https://www.vircom.com/blog/a-critique-what-is-dmarc-missing/</a></p>\n</li>\n</ul>\n<h2 id=\"certificate-concepts\">Certificate Concepts</h2>\n<p>The following is non exhaustive and meant as a pointer for the more commonly used concepts in regards to issuing Certificates.</p>\n<h3 id=\"caa-record-sending-only\">CAA-Record ; sending-only</h3>\n<p>Also known as the <strong>Certification Authority Authorization</strong> DNS-Record is intended to provide insight / authorization in issuing Certificates and was specified in <a href=\"https://datatracker.ietf.org/doc/html/rfc8659\">RFC 8659</a>.<br>The basic idea is that a Certificat Authory e.g like <a href=\"https://letsencrypt.org/\" data-card-appearance=\"inline\">https://letsencrypt.org/</a> which we are using in our productive cloud clusters, has to check for the existince of a CAA record first, before proceeding with issueing a certificate.</p>\n<h4 id=\"details-about-the-dns-record\">Details about the DNS-Record</h4>\n<p>A CAA Recrord consists of these 3 parts with a maximum of 1 value each:, BUT muliple CAA Records can exists per domain:</p>\n<pre><code class=\"language-text\">CAA &lt;flags&gt; &lt;tag&gt; &lt;value&gt;</code></pre>\n<ul>\n<li>\n<p><strong>flag</strong></p>\n<ul>\n<li>\n<p>A positive number between 0 - 255, currently not in use and must always be <strong>0</strong></p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>tag</strong></p>\n<ul>\n<li>\n<p>Currently supports these 3:</p>\n<ul>\n<li>\n<p><strong>issue</strong></p>\n<ul>\n<li>\n<p>Allows for the issuing of any type of certificate for this domain / subdomain by the Certificate Authority specified as value</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>issuewild</strong></p>\n<ul>\n<li>\n<p>Allows for the issuing of Wild-Card certificates only for this domain / subdomain by the Certificate Authority specified as value</p>\n</li>\n<li>\n<p>Only get’s evaluated if the FQDN of the certificate is for a Wilrdcard-Certificate</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>iodef</strong></p>\n<ul>\n<li>\n<p>In case the CA supports it, the CAA is instructed to report invalid Certificate requests as an incident</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>value</strong></p>\n<ul>\n<li>\n<p>in case of tag <strong>issue/issuewild</strong> the value can be</p>\n<ul>\n<li>\n<p>The certificate Certificate Authority issuer domain:<br>As specified by respective CAA, e.g. ‘<a href=\"http://letsencrypt.org\">letsencrypt.org</a>’ for <a href=\"https://letsencrypt.org/\" data-card-appearance=\"inline\">https://letsencrypt.org/</a></p>\n</li>\n<li>\n<p>';'<br>A single semicolon specifys &lt;no-value&gt;, which means that no certificates should be issued</p>\n</li>\n<li>\n<p>a value containing invalid characters (not supported for a domain name, e.g. ‘%%%%%%%%%’ Is treated as &lt;no-value&gt; as well, which means that no certificates should be issued</p>\n</li>\n<li>\n<p><strong>Note: </strong></p>\n<ul>\n<li>\n<p>Multiple CAA issue*-Records wil work additively</p>\n</li>\n<li>\n<p>So &lt;no-value&gt; issue* Records will be ignored if another valid issuer* Record exists</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>in case of tag <strong>iodef</strong></p>\n<ul>\n<li>\n<p>Email or webservice endpoint e.g. ‘<a href=\"mailto:some@example.com\">mailto:some@example.com</a>’</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"how-are-existing-caa-records-used-a-caa-when-issuing\">How are existing CAA Records used a CAA when issuing</h4>\n<p>First and foremost, if no CAA Records can be found on a domain, certificate issuance is not impeded.</p>\n<p><strong>(1) To Check for a relevant CAA record, the Certificate authority works as follows:</strong></p>\n<ol start=\"1\">\n<li>\n<p>Start with the FQDN of the domain that is requested for the certificate</p>\n</li>\n<li>\n<p>Query that domain for CAA-Records</p>\n</li>\n<li>\n<p>Decide further steps based on the result</p>\n<ol start=\"1\">\n<li>\n<p>IF CAA records are found, exit - procede with CAA evaluation</p>\n</li>\n<li>\n<p>IF no CAA records a found</p>\n<ol start=\"1\">\n<li>\n<p>Check if the domain to be checked is an apex-domain</p>\n</li>\n<li>\n<p>IF yes, exit - No CAA records were found</p>\n</li>\n<li>\n<p>IF no, select the next domain by removing the leading part of the current domain incl. the '.' - go back to step 2</p>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<p><strong>(2) Evaluate the CAA records:</strong></p>\n<p>If at least one record is found that contains the issue domain of the CA → proceed with issuing the certificate</p>\n<ul>\n<li>\n<p>If NOT, then check if a CAA record exists with tag ‘iodef’</p>\n<ul>\n<li>\n<p>If it exists report the incident based on the value iside the DNS-Record</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li>\n<p><a href=\"https://datatracker.ietf.org/doc/html/rfc8659\" data-card-appearance=\"inline\">https://datatracker.ietf.org/doc/html/rfc8659</a> , especially section</p>\n<ul>\n<li>\n<p><a href=\"https://datatracker.ietf.org/doc/html/rfc8659#section-3\" data-card-appearance=\"inline\">https://datatracker.ietf.org/doc/html/rfc8659#section-3</a> - Section 3 (The lookup algorithm)</p>\n</li>\n<li>\n<p><a href=\"https://datatracker.ietf.org/doc/html/rfc8659#section-4.1.1\" data-card-appearance=\"inline\">https://datatracker.ietf.org/doc/html/rfc8659#section-4.1.1</a> - Sections 4.1.1 and onwards (For a more detailed exmplanation of the different parts of a CAA DNS-Record</p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://letsencrypt.org/docs/caa/\" data-card-appearance=\"inline\">https://letsencrypt.org/docs/caa/</a> - An explanation as relevant for Let’s Encrypt</p>\n</li>\n<li>\n<p><a href=\"https://support.dnsimple.com/articles/caa-record/\" data-card-appearance=\"inline\">https://support.dnsimple.com/articles/caa-record/</a> - An article explaining the CAA record</p>\n</li>\n</ul>\n<h2 id=\"dns-and-email-in-efs-how-to-pitfalls\">DNS and Email in EFS (How-to / Pitfalls)</h2>\n<p> </p>\n<p>There are 4 theoretic Use-Cases regarding Domains and Email for how they are used in EFS:</p>\n<ol start=\"1\">\n<li>\n<p>Domain will be used <strong>only for sending</strong> of mail, <strong>no Alias</strong> will be configured</p>\n<ol start=\"1\">\n<li>\n<p>Only customer is responsible</p>\n</li>\n<li>\n<p>We recommend an SPF-Record as shown below</p>\n</li>\n</ol>\n</li>\n<li>\n<p>Domain will be configured as EFS-Alias &amp; used <strong>only for accessing</strong> the installation (<strong>Note-</strong> L1 agent helper for Alias setup: <a href=\"https://ww2.efs-survey.com/uc/alias_setup/\">https://ww2.efs-survey.com/uc/alias_setup/</a>)</p>\n<ol start=\"1\">\n<li>\n<p>IP-Related records shown below are relevant</p>\n</li>\n</ol>\n</li>\n<li>\n<p>Configured as EFS-Alias &amp; used<strong> only for sending mai</strong>l (Mail-Sender)</p>\n<ol start=\"1\">\n<li>\n<p>Mail-Related records shown below are relevant</p>\n</li>\n</ol>\n</li>\n<li>\n<p>Configured as EFS-Alias &amp; used for <strong>accessing + sending mails</strong> (Browser-Address-Bar &amp; Mail-Sender)</p>\n<ol start=\"1\">\n<li>\n<p>IP-Related records shown below are relevant</p>\n</li>\n<li>\n<p>Mail-Related records shown below are relevant</p>\n</li>\n</ol>\n</li>\n</ol>\n<p>Nearly all of these use-cases require some for of DNS-Record configuration. Configuration goal:</p>\n<ul>\n<li>\n<p>Domain-IP in all cases is the same as the one used by the installation itself</p>\n</li>\n<li>\n<p>Customer does not need to do any DNS-Modification, if the IP has to be changed</p>\n</li>\n<li>\n<p>Mailing-Configuration is not restricted in any way</p>\n</li>\n</ul>\n<p>The following will describe the optimal set of DNS Records for a EFS-Alias-Domain &amp; Steps on how to reach this goal / possible workarounds.</p>\n<h3 id=\"recommended-efs-alias-domain-dns-records-directly-pointing-to-efs\">Recommended EFS-Alias-Domain DNS Records directly pointing to EFS</h3>\n<h4 id=\"ip-related-entries-for-apex-domain-incl-www-subdomain\">IP-Related entries - For Apex-Domain incl. www-Subdomain</h4>\n<pre><code class=\"language-text\">example.com IN ALIAS(or ANAME or Flattened-CNAME) &lt;ab1234&gt;.customervoice360.com.\n\nwww.example.com IN CNAME example.com.\nor\nwww.example.com IN ALIAS(or ANAME or Flattened-CNAME) example.com.</code></pre>\n<h4 id=\"ip-related-entries-for-sub-domain-only\">IP-Related entries - For Sub-Domain only</h4>\n<pre><code class=\"language-text\">some.example.com IN ALIAS(or ANAME) &lt;ab1234&gt;.customervoice360.com.</code></pre>\n<h4 id=\"mail-related-entries\">Mail-related entries</h4>\n<pre><code class=\"language-text\">(some.)example.com IN MX &lt; e.g. 10 {customer-recieveing-mail-host}&gt;\n\n(some.)example.com IN TXT \"v=spf1 &lt;additional-mechanisms&gt; include:spf.qb-feedback.com -all\"\n\n&lt;selector, usually 'qb'&gt;._domainkey.(some.)example.com IN TXT \"v=DKIM1; k=rsa; p=&lt;public-key&gt;\"\n\n_dmarc.(some.)example.com IN TXT \"v=DMARC1; p=none; pct=100; aspf=s; adkim=s; rua=mailto:&lt;customer-dmarc-reporting-mail&gt;;\"\nor\n_dmarc.(some.)example.com IN TXT \"v=DMARC1; p=quarantine; pct=100; aspf=s; adkim=s; rua=mailto:&lt;customer-dmarc-reporting-mail&gt;;\"\nor\n_dmarc.(some.)example.com IN TXT \"v=DMARC1; p=reject; pct=100; aspf=s; adkim=s; rua=mailto:&lt;customer-dmarc-reporting-mail&gt;;\"\n\nspecial case DMARC example:\n_dmarc.some.example.com IN TXT \"v=DMARC1; p=reject; pct=100; aspf=s; adkim=s; rua=mailto:dmarc-reporting@example.net;\"\nsome.example.com._report._dmarc.example.net IN TXT \"v=DMARC1\"</code></pre>\n<ul>\n<li>\n<p>Verification-Tool for SPF &amp; DKIM: <a href=\"https://www.mail-tester.com/spf-dkim-check\">https://www.mail-tester.com/spf-dkim-check</a></p>\n</li>\n</ul>\n<h4 id=\"optional-certificate-related-entries\">(optional) Certificate-related entries</h4>\n<pre><code class=\"language-text\">(some.)example.com IN CAA issue \"letsencrypt.org\"</code></pre>\n<h4 id=\"special-case-domain-will-point-to-cdn-e-g-akamai-waf-e-g-cloudflare\">Special case: Domain will point to CDN (e.g. Akamai) / WAF (e.g. Cloudflare)</h4>\n<ul>\n<li>\n<p>The Backend of the Service-Provider <strong>must</strong> be configured to use the <strong>technical domain</strong> of the installation</p>\n</li>\n<li>\n<p>Recommendation:</p>\n<ul>\n<li>\n<p>IP-Related Records are setup as shown above but targeting the Service-Provider-Domain instead</p>\n</li>\n<li>\n<p>Mail-Related records are setup as shown above, if domain is intended for mailing</p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"special-case-technical-domain-is-akamized\">Special case: Technical domain is Akamized</h4>\n<ol start=\"1\">\n<li>\n<p>An additional technical-domain has to be setup, just for all aliases, see below</p>\n</li>\n<li>\n<p>Afterwards DNS-Records should be setup as described before but instead targeting the technical-alias-domain</p>\n</li>\n</ol>\n<pre><code class=\"language-text\">&lt;installation-short-name&gt;-aliases.customervoice360.com IN CNAME &lt;domain-of-service-backend&gt;.</code></pre>\n<h3 id=\"how-to-match-recommended-record-setup-as-close-as-possible-for-customer-managed-domain\">How to match recommended Record-Setup as close as possible for customer managed domain</h3>\n<p>The following shows the different options available in descending order of preference with corresponding:</p>\n<ul>\n<li>\n<p>Advantages</p>\n</li>\n<li>\n<p>Disadvantages</p>\n</li>\n<li>\n<p>How-To</p>\n</li>\n</ul>\n<h4 id=\"alias-aname-record-cname-flattening\">ALIAS- / ANAME-Record / CNAME Flattening</h4>\n<ul>\n<li>\n<p>Advantages:</p>\n<ul>\n<li>\n<p><span style=\"color: #36b37e;\">Recommended record-set can be created 1-to-1</span></p>\n</li>\n<li>\n<p><span style=\"color: #36b37e;\">All configuration goals can be reached</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>Disadvantages:</p>\n<ul>\n<li>\n<p><span style=\"color: #ff5630;\">Not availabl at all DNS-Providers, as they are non standard (see above)</span></p>\n</li>\n<li>\n<p><span style=\"color: #ff5630;\">Naming of the Record-Type depends on the provider</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>How-To:</p>\n<ul>\n<li>\n<p>Customer has to setup records as recommended above</p>\n</li>\n<li>\n<p>Examples</p>\n<ul>\n<li>\n<pre><code class=\"language-text\">domain.tld IN ALIAS eg1337.customervoice360.com\ndomain.tld IN ANAME eg1337.customervoice360.com\ndomain.tld IN Flattened-CNAME eg1337.customervoice360.com\nor\nsome.domain.tld IN ALIAS eg1337.customervoice360.com.\nsome.domain.tld IN ANAME eg1337.customervoice360.com.\nsome.domain.tld IN Flattened-CNAME eg1337.customervoice360.com.</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"ns-record\">NS-Record</h4>\n<ul>\n<li>\n<p>Advantage:</p>\n<ul>\n<li>\n<p><span style=\"color: #36b37e;\">Tivian can manage all records as necessary</span></p>\n<ul>\n<li>\n<p><span style=\"color: #36b37e;\">The Name-Server which will be configured does support ALIAS- / ANAME-Record</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p><span style=\"color: #36b37e;\">Customer still owns the domain (No transfer necessary)</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>Disadvantages:</p>\n<ul>\n<li>\n<p><span style=\"color: #ff5630;\">As all records are managed by Tivian only, all changes entail customer communication, therefore increased support costs</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>How-To (Sysadmin-Manual, [DNS] How to setup Customer-Owned alias domain via NS-Record ):</p>\n<ul>\n<li>\n<p>1. Retrieve <strong>all </strong>DNS-Entries (On Apex- and Sub-Domains) from customer</p>\n</li>\n<li>\n<p>2. QB-SAs have to recreate all DNS-Entries</p>\n</li>\n<li>\n<p>3. QB-SAs have to setup DNS-Records like “Option 2)”</p>\n</li>\n<li>\n<p>4. Customer has to setup / replace following Records for the domain:</p>\n<ul>\n<li>\n<pre><code class=\"language-text\">&lt;domain&gt; IN NS ns1.opst.de.\n&lt;domain&gt; IN NS ns2.opst.de.\ne.g.\nexample.com IN NS ns1.opst.de.\nexample.com IN NS ns2.opst.de.\nanother.example.net IN NS ns1.opst.de.\nanother.example.net IN NS ns2.opst.de.</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>5. Customer should remove all other DNS-Records except the previously mentioned NS-Records</p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"cname-record-only-for-sub-domains\">CNAME-Record (Only for Sub-Domains)</h4>\n<ul>\n<li>\n<p>Advantages:</p>\n<ul>\n<li>\n<p><span style=\"color: #36b37e;\">Domain is ensured to resolve to the intended IP at all time</span></p>\n</li>\n<li>\n<p><span style=\"color: #36b37e;\">In case of an IP change no intervention by the customer is needed</span></p>\n</li>\n<li>\n<p><span style=\"color: #36b37e;\">DKIM &amp; DMARC are not affected</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>Disadvantages:</p>\n<ul>\n<li>\n<p><span style=\"color: #ff5630;\">All DNS-Queries are redirect =&gt; customer can </span><strong><span style=\"color: #ff5630;\">not </span></strong><span style=\"color: #ff5630;\">set </span><strong><span style=\"color: #ff5630;\">any other</span></strong><span style=\"color: #ff5630;\"> records themselves</span></p>\n</li>\n<li>\n<p><span style=\"color: #ff5630;\">Problem for MX-Record: All reply mails will go to a single Mail-server that must accept them, meaning</span></p>\n<ul>\n<li>\n<p><span style=\"color: #ff5630;\">this domain</span></p>\n</li>\n<li>\n<p><span style=\"color: #ff5630;\">the generic-domain of the installation</span></p>\n</li>\n<li>\n<p><span style=\"color: #ff5630;\">other Alias-Domains of the installation with CNAME-Records</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p><span style=\"color: #ff5630;\">Problem for SPF-Record: Only single record for the whole installation (problematic for lookup-limit)</span></p>\n</li>\n<li>\n<p><strong><span style=\"color: #ff5630;\">Not cloud compatible: </span></strong><span style=\"color: #ff5630;\">because the customervoice domain directly points to our Loadbalancer-Abstraction-Domain for all installations no custom Records can be defined for the customervoice domain as these would be valid for all our customers</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>How-To:</p>\n<ul>\n<li>\n<p>Inform customer that they need to setup a record like:</p>\n<ul>\n<li>\n<pre><code class=\"language-text\">&lt;domain&gt; IN CNAME &lt;ab1234&gt;.customervoice360.com\ne.g.\nsome.example.com IN CNAME eg1337.customervoice360.com.</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Workarounds (Only <strong>non-cloud</strong>):</p>\n<ul>\n<li>\n<p>SPF-Record, either:</p>\n<ul>\n<li>\n<p>Create a consolidated SPF-Record encompassing rules for all aliases, e.g.</p>\n<ul>\n<li>\n<p><strong>!!Be aware of the lookup-limit!!</strong></p>\n</li>\n<li>\n<pre><code class=\"language-text\">\"v=spf1 &lt;additional-alias1&gt; &lt;additional-alias2&gt; &lt;...&gt; include:spf.qb-feedback.com -all\"</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>Build a special macro based record that includes rules dynamically + custom QB-managed-records</p>\n<ul>\n<li>\n<p>Untested</p>\n</li>\n<li>\n<pre><code class=\"language-text\">TBD</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>MX-Record :</p>\n<ul>\n<li>\n<p>(not recommended) Never send any mail for which the deposited mail-server does not accept answers</p>\n</li>\n<li>\n<p>(Not offered by Tivian) Setup of a single mail-relay, which then relays the mails as needed</p>\n<ul>\n<li>\n<p>Make sure to append the SFP-Record accordingly to prevent fails</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"domain-transfer\">Domain-Transfer</h4>\n<ul>\n<li>\n<p>Advantage:</p>\n<ul>\n<li>\n<p><span style=\"color: #36b37e;\">Tivian can manage all records as necessary</span></p>\n<ul>\n<li>\n<p><span style=\"color: #36b37e;\">The DNS-Provider we use does support ALIAS- / ANAME-Record</span></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Disadvantages:</p>\n<ul>\n<li>\n<p><span style=\"color: #ff5630;\">Customer is no longer in control of the domain =&gt; no change without ticket at Tivian</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>How-To:</p>\n<ul>\n<li>\n<p><strong>TBD </strong>… but in general transfer has to be initiated, QB has to setup matching records to prevent disruption</p>\n</li>\n<li>\n<p>Tivian can setup the domain so that customer is still domain owner (We put in their values during domain registration), but Tivian will be put down as technical contact</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"customer-handover-templates\">Customer Handover Templates</h3>\n<h4 id=\"for-apex-domains-incl-www-subdomain-not-if-akamai-is-in-the-mix\">For Apex-Domains (incl. www-Subdomain) (NOT: if Akamai is in the Mix!)</h4>\n<p>Replace:</p>\n<ul>\n<li>\n<p><code>&lt;Alias-Domain&gt;</code> with the Apex-Domain of the customer, e.g. <code>example.com</code></p>\n</li>\n<li>\n<p><code>&lt;ab1234&gt;.customervoice360.com</code> with the technical domain of the installation</p>\n</li>\n</ul>\n<pre><code class=\"language-text\">Hi TS / 1st,\n\n\nFor this Domain to work properly as an EFS-Alias the customer has to setup DNS first.\nThere are multiple options available, which are the following in descending order of preference:\n\n\nOption 1) ALIAS- / ANAME-Record / CNAME Flattening or similar Feature\nThere is no official name for this, but if the DNS-Provider supports it, it will propably be named like that.\n\nThe Record that will have to be configured should look like one of the following:\n&lt;Alias-Domain&gt; IN ALIAS &lt;ab1234&gt;.customervoice360.com\n&lt;Alias-Domain&gt; IN ANAME &lt;ab1234&gt;.customervoice360.com\n&lt;Alias-Domain&gt; IN Flattened-CNAME &lt;ab1234&gt;.customervoice360.com\n\n(if applicable) For the www-Subdomain:\nwww.&lt;Alias-Domain&gt; IN CNAME &lt;Alias-Domain&gt;\n\n\nOption 2) NS-Records\nWith this Tivian takes over all of the DNS-Record Management whithout requiring a DNS-Transfer.\n\nThis is a multi-step process which is disruption-free:\n1. We need a list of all DNS-Records already on the domain\n2. We will then set the up every DNS-Record in that list on our end\n3. We configure addtional DNS-Records required by EFS\n3. We provide the NS-Record that has to be setup\n4. Once the NS-Record is setup the domain-setup is complete\n\n\nOption 3) Domain-Transfer\nThe last option would be a Domain-Transfer. We have a Reseller-Contract in place with our DNS-Provider Variomedia.\nThis way we can set up the domain in a way that the customer remains the domain owner but Tivian deposited as the Technical-Contact.\nThis way Tivian will manage all DNS-Records, this means any DNS-Change will have to be requested via a Tivian-Support-Ticket.\n\nTo get this done disruption-free we need the following:\n1. Customer Contact-Info for the Domain-Registration-Preperation at Variomedia\n2. A list of all DNS-Records already on the domain\n\n\nRegards\n&lt;Your Name ;-)&gt;</code></pre>\n<h4 id=\"for-subdomains-not-if-akamai-is-in-the-mix\">For Subdomains (NOT: if Akamai is in the Mix!)</h4>\n<p>Replace:</p>\n<ul>\n<li>\n<p><code>&lt;Alias-Domain&gt;</code> with the Sub-Domain of the customer, e.g. <code>some.example.com</code></p>\n</li>\n<li>\n<p><code>&lt;ab1234&gt;.customervoice360.com</code> with the technical domain of the installation</p>\n</li>\n</ul>\n<pre><code class=\"language-text\">Hi TS / 1st,\n\n\nFor this Domain to work properly as an EFS-Alias the customer has to setup DNS first.\nThere are multiple options available, which are the following in descending order of preference:\n\n\nOption 1) ALIAS- / ANAME-Record / CNAME Flattening or similar Feature\nThere is no official name for this, but if the DNS-Provider supports it, it will propably be named like that.\n\nThe Record that will have to be configured should look like one of the following:\n&lt;Alias-Domain&gt; IN ALIAS &lt;ab1234&gt;.customervoice360.com\n&lt;Alias-Domain&gt; IN ANAME &lt;ab1234&gt;.customervoice360.com\n&lt;Alias-Domain&gt; IN Flattened-CNAME &lt;ab1234&gt;.customervoice360.com\n\n\nOption 2) NS-Records\nWith this Tivian takes over all of the DNS-Record Management without requiring a DNS-Transfer.\n\nThis is a multi-step process which is disruption-free:\n1. We need a list of all DNS-Records already on the domain\n2. We will then set the up every DNS-Record in that list on our end\n3. We configure addtional DNS-Records required by EFS\n3. We provide the NS-Record that has to be setup\n4. Once the NS-Record is setup the domain-setup is complete\n\n\nOption 3) CNAME-Record:\nThis is Variant has implications regarding E-Mail.\nFor advantages, disatvantages and workarounds, see (QB-Internal - Confluence): https://qbdocs.atlassian.net/wiki/spaces/PROC/pages/1261895715/The+world+of+DNS+Email+and+how+it+relates+to+EFS+-Aliases#How-to-match-recommended-Record-Setup-as-close-as-possible-for-customer-managed-domain\n\nThe Records that will have to be configured should look like:\n&lt;Alias-Domain&gt; IN CNAME &lt;ab1234&gt;.customervoice360.com\n\n\nOption 4) Domain-Transfer\nThe last option would be a Domain-Transfer. We have a Reseller-Contract in place with our DNS-Provider Variomedia.\nThis way we can set up the domain in a way that the customer remains the domain owner but Tivian deposited as the Technical-Contact.\n\nThis way Tivian will manage all DNS-Records, this means any DNS-Change will have to be requested via a Tivian-Support-Ticket.\nTo get this done disruption-free we need the following:\n1. Customer Contact-Info for the Domain-Registration-Preperation at Variomedia\n2. A list of all DNS-Records already on the domain\n\n\nRegards\n&lt;Your Name ;-)&gt;</code></pre>\n<h2 id=\"examples-for-currently-supported-dns-chains-if-customer-dns-does-not-support-alias-records\">Examples for currently supported DNS Chains if customer DNS does not support ALIAS records</h2>\n<h3 id=\"apex-domains\">Apex Domains</h3>\n<p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20426304988562\" alt=\"grafik-20220819-133807.png\"></p>\n<p> </p>\n<h3 id=\"sub-domains-1\">Sub Domains</h3>\n<h4 id=\"sub-domains-without-support-for-additional-records\">Sub Domains - Without support for additional records</h4>\n<p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20426271189778\" alt=\"grafik-20220819-134738.png\"></p>\n<p> </p>\n<h4 id=\"sub-domains-with-support-for-additional-records\">Sub Domains - WITH support for additional records</h4>\n<p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20426271440018\" alt=\"grafik-20220819-134705.png\"></p>\n<p> </p>",
    "user_segment_ids": [
        360000084973
    ]
}