{
    "id": 22090185803410,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/22090185803410.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/22090185803410-Troubleshooting-Survey-Replies-and-Master-data-allocation-across-logs",
    "author_id": 1904316023094,
    "comments_disabled": false,
    "draft": false,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20389541164690,
    "created_at": "2024-10-20T12:13:35Z",
    "updated_at": "2024-10-21T13:07:04Z",
    "name": "Troubleshooting Survey Replies and Master data allocation across logs",
    "title": "Troubleshooting Survey Replies and Master data allocation across logs",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-10-21T13:07:03Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [
        "Troubleshooting",
        "Data Transfer",
        "Profiler Survey",
        "Master Data Variables"
    ],
    "body": "<h1 id=\"h_01JAMY3QTZHHC3R15CVH1BZEW8\">Overview</h1>\n<p>This KB is designed to help agents troubleshoot issues related to survey replies, specifically tracing them from the user’s submission to AWS DB logs, MariaDB, and Grafana PHP logs. This guide will also assist in troubleshooting scenarios where survey-related updates, such as master data updates, fail to reflect correctly in the system.</p>\n<p>Key troubleshooting areas include:</p>\n<ol>\n<li>Use GUI or MariaDB to detect the exact timings of requests when a Specific User Filled a specific Survey</li>\n<li>Locating survey replies in the database (MariaDB)</li>\n<li>Reviewing AWS DB logs to investigate issues with connection IDs and master data transfers</li>\n<li>Examining Grafana PHP logs for errors during survey completion</li>\n<li>Understanding how the system processes master data allocations from surveys</li>\n</ol>\n<hr>\n<h1 id=\"01JAMY6CPVCVPQE07E9PSFRSD5\">Solution</h1>\n<h3 id=\"h_01JAMY3QTZFTZF2NVFF0A9NP3Z\"><strong>1. How to Find When a Specific User Filled a Survey Through the GUI</strong></h3>\n<h4 id=\"h_01JAN33CA9RSM2WG03F3QMDNEQ\"><strong>Panel Surveys (PA)</strong></h4>\n<ul>\n<li>\n<strong>Path</strong>: <code>Survey menu &gt;&gt; Statistics &gt;&gt; Detail view</code> (search for the specific panelist)<br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/22091322769554\">\n</li>\n<li>\n<strong>Alternate Path</strong>: <code>People &gt;&gt; Panelist administration &gt;&gt; Detail view &gt;&gt; Surveys</code>\n</li>\n<li>\n<strong>Master Data Allocation: </strong>check <code>Survey Menu &gt;&gt; Master Data Allocation</code> for Survey to Master Data mapping</li>\n</ul>\n<p>Look for:</p>\n<ul>\n<li>\n<strong>Date of last access</strong>: Shows when the user last accessed the survey.</li>\n<li>\n<strong>Disposition code</strong>: Indicates if the survey was completed, abandoned, etc.</li>\n<li>If the <strong>Date of last access</strong> is not visible, click the \"View\" button and select it.</li>\n</ul>\n<h4 id=\"h_01JAN33CAA8GMNWAB5F44AKNZG\"><strong>Personalized Surveys (PE/ES/MSF)</strong></h4>\n<ul>\n<li>\n<strong>Path</strong>: <code>Survey menu &gt;&gt; Statistics &gt;&gt; Detail view</code> (search for the specific participant)</li>\n<li>This section shows the user’s survey activity, including <strong>Date of last access</strong> and <strong>Disposition code</strong>.</li>\n</ul>\n<h4 id=\"h_01JAN33CAAQMERRNAJ22E505FE\"><strong>Anonymous Surveys (AS)</strong></h4>\n<ul>\n<li>\n<strong>Path</strong>: <code>Survey menu &gt;&gt; Statistics &gt;&gt; Detail view</code> (search for the specific LFDN)</li>\n<li>For anonymous participants, search by <strong>LFDN</strong> (Participant #) to find survey completion details. </li>\n</ul>\n<p>To check <strong>all the page requests</strong> related to a survey by a user, please check the table <strong>ospe_time_log </strong>as mentioned below.</p>\n<h3 id=\"h_01JAN3FY97YSFG41E7FB070Q2V\"><strong>2. Finding Survey Replies in MariaDB</strong></h3>\n<p>Survey replies can be traced using various tables depending on the <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20370699710866-Projects#project-types\">survey type</a> (PA, PE, ES, MSF). To check if a user completed a specific survey, follow these steps:</p>\n<h4 id=\"h_01JAMY3QTZJW2KNRA708A1AQR8\">\n<strong>Tables to Query</strong>:</h4>\n<ul>\n<li>\n<p><strong>PA (Panel Attendees)</strong>:</p>\n<ul>\n<li>\n<code>sample_data</code>: Contains metadata about survey participation (including <code>date_of_last_access</code>).</li>\n<li>\n<code>panelists</code>: Contains user-specific information.</li>\n<li>\n<code>panel_att</code>: contains additional information you can see in the detail view of panelists like pseudonym, panelist_code, credit points etc.)</li>\n<li>\n<code>survey_{{PID}}</code>: Holds survey variables and answers provided by the participants.</li>\n<li>\n<code>md_data</code>: Stores master data variables transferred from surveys. <br><br>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>PE/MSF/ES (<a href=\"#h_01JAMY3QTZY2V3E78R7QGJR831\">Personalized</a> Surveys)</strong>:</p>\n<ul>\n<li>\n<code>sample_data</code>: Contains metadata about survey participations i.e. date of last access.</li>\n<li>\n<code>survey_{{PID}}</code>: Stores survey variables and responses.</li>\n<li>\n<code>users_{{PID+1}}</code>: Contains user-specific variables separated from the survey for privacy.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"h_01JAMY3QTZCPZGN82TFBBJSVPB\">\n<strong>Suggested Steps</strong>:</h4>\n<ol>\n<li>\n<p><strong>Search for User ID</strong> (<code>uid</code>):</p>\n<ul>\n<li>Start by locating the participant using their <code>uid</code>. This <code>uid</code> will help you join relevant tables like <code>sample_data</code> and <code>survey_{{PID}}</code>. PID is projectID from GUI.</li>\n</ul>\n</li>\n<li>\n<p><strong>Check the <code>sample_data</code> table</strong>:</p>\n<ul>\n<li>Use the <code>sample_data</code> table to find when the survey was last accessed by checking <code>date_of_last_access</code>. You can limit the query by filtering on <code>uid</code>, <code>lfdn</code>, and <code>pid</code> to narrow it down to the survey in question.</li>\n</ul>\n</li>\n<li>\n<p><strong>Verify Survey Completion</strong>:</p>\n<ul>\n<li>Cross-check the survey completion status in the <code>survey_{{PID}}</code> table. Look for key fields such as \"disposition code\" or \"status\" (e.g., <code>status = 31</code>) that indicate survey completion.</li>\n</ul>\n</li>\n<li>Extra tables\n<ul>\n<li>A lot of other panel specific tables can be joined also using the user ID (uid) of a panelist (i.e. panelist_bonus_points, panelist_grp, etc.)</li>\n</ul>\n</li>\n<li>\n<strong>Watchdog (ospe_time_log Table):</strong>\n<ul>\n<li>The Watchdog (<code>System &gt;&gt; Options &gt;&gt; Patform cockpit &gt;&gt; OSPE Watchdog</code>) is based on the DB table <strong>ospe_time_log</strong> which provides the performance stats for each participant for <strong>each sent page</strong>. Here you can get the user ID (uid) and <strong>timestamp</strong> of each request if you would like to look at the DB log in CW for example:</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"h_01JAMY3QTZWKFF95W8QRBMB0XP\">\n<strong>Example Query to get info to help with CW logs search</strong>:</h4>\n<div class=\"contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary dark:bg-gray-950\">\n<div class=\"overflow-y-auto p-4\" dir=\"ltr\">\n<pre><code class=\"language-plaintext\">SELECT \n    pa.uid, \n    pa.pseudonym, \n    sd.status, \n    sd.date_of_last_access, \n    s.v_603, \n    md.md_us_cs_seed, \n    s.v_646, \n    md.md_us_ca_corn, \n    s.v_654, \n    md.md_us_ca_sorghum, \n    s.page_history \nFROM \n    survey_44730 AS s \nLEFT JOIN \n    panel_att AS pa ON (s.uid = pa.uid) \nLEFT JOIN \n    md_data AS md ON (s.uid = md.uid) \nLEFT JOIN \n    sample_data AS sd ON (s.uid = sd.uid AND s.lfdn = sd.lfdn) \nWHERE \n    pa.pseudonym IN (483706145, 463706643);\n</code></pre>\n</div>\n<div class=\"overflow-y-auto p-4\" dir=\"ltr\"><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/22092281210514\"></div>\n<div class=\"overflow-y-auto p-4\" dir=\"ltr\">Or using ospe_time_log:<br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/22092281210770\">\n</div>\n<div class=\"overflow-y-auto p-4\" dir=\"ltr\"> </div>\n</div>\n<hr>\n<h3 id=\"h_01JAMY3QTZY2V3E78R7QGJR831\"><strong>3. Checking AWS DB Logs for survey related requests</strong></h3>\n<p>If a survey’s response data or master data variables are not updated correctly, the issue may be further checked at the <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/22010573804818-Accessing-and-Querying-AWS-Cloudwatch-DB-Logs\">AWS DB Logs</a> level. Specifically, you might be looking for failed connection IDs.</p>\n<h4 id=\"h_01JAMY3QTZBBYQCPQ1E6JVGE5D\">\n<strong>Steps</strong>:</h4>\n<ol>\n<li>\n<p><strong>Identify Connection IDs</strong>:</p>\n<ul>\n<li>Given the exact time of the request (deducted from above steps through DB), and the different fields (ex: uid, pid, etc..) , you should be able to look for the connectionID in AWS logs.<br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/22092277009554\">\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Review Log Entries</strong>:</p>\n<ul>\n<li>Check log entries for <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/22010573804818-Accessing-and-Querying-AWS-Cloudwatch-DB-Logs#h_01JAN59M52T72NERA01VW3V8Q2\">incomplete connections</a> (CONNECTIONID entries without a \"Quit\" event or in Error log group) to identify abandoned or incomplete surveys.</li>\n<li>Analyze these logs for unexpected queries</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3 id=\"h_01JAMY3QTZ78PKQT3GGVYBHDS4\"><strong>4. Reviewing Grafana PHP Logs for Survey Errors</strong></h3>\n<ul>\n<li>All the PHP requests are normally tracked through <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21741183591314\">Grafana</a>.</li>\n<li>You can look for errors and unexpected requests using the <strong>timestamp of relevant request </strong>as found in MariaDB</li>\n</ul>\n<hr>\n<h3 id=\"h_01JAMY3QTZXCW2DDDCF6ZYN4HR\"><strong>5. Troubleshooting Master Data Updates</strong></h3>\n<p>If a survey’s master data allocation fails (e.g., <code>md_us_ca_corn</code> is not updated), this indicates that the transfer of data from the survey to the master data section encountered an issue. All the above steps apply, in addition to the below.</p>\n<h4 id=\"h_01JAMY3QTZ26R87DTYX4GG3F4C\">\n<strong>Steps</strong>:</h4>\n<ol>\n<li>\n<p><strong>Master Data Allocation Setup</strong>:</p>\n<ul>\n<li>Verify that the master data allocation rules in the survey setup were correct. This can be checked in the survey configuration under <strong>Survey menu &gt;&gt; Master Data Allocation</strong>.</li>\n</ul>\n</li>\n<li>\n<strong>Check the step which should transfer the master data, and when should the transfer EXECUTE</strong>\n<ul>\n<li>For instance, check this example survey where the participant had been set to dispostione code/status 31 respectively 32 and we know that this is happening on the final page.\n<p><span style=\"opacity: 1;\"><img id=\"image_39a7b195-25a6-4b5e-b470-34545b99be52\" class=\"image_resized\" style=\"width: 788px;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/EtF7IJ2IZ02qPycuv2oLEedAU/?name=inlineImage.png\"></span></p>\n<p> </p>\n</li>\n<li>\n<p><strong>Important: </strong>Check when is the <strong>transfer of the master data allocation</strong> processed. <br>For example, in the below it is configured when completing the survey (in other words when reaching the final page).</p>\n<p><span style=\"opacity: 1;\"><img id=\"image_4778ccd0-520c-409d-91b8-f969bcc11825\" class=\"image_resized\" style=\"width: 870px;\" src=\"https://central-supportdesk.zendesk.com/attachments/token/ckOFRFnKqSzq0diEZIhMPLUMS/?name=inlineImage.png\"></span></p>\n<p>Therefore we know \"when\" this should happen, which is at around the same time the participant was set to \"<em>status</em> = 31\" which is the \"<em>date_of_last_access</em>\". Both are meta data of the survey and could be found in the `sample_data` table</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Check Transfer in Logs</strong>:</p>\n<ul>\n<li>Use AWS logs to trace when the system attempted to update the master data. Cross-check these logs with the timestamps for the survey completion.</li>\n</ul>\n</li>\n<li>\n<p><strong>Investigate Missing Updates</strong>:</p>\n<ul>\n<li>If the logs indicate that the transfer did not happen, check if the participant’s connection was abandoned or if a specific variable (e.g., <code>md_us_ca_corn</code>) had a trigger issue.</li>\n</ul>\n</li>\n<li>\n<strong>DB Updates</strong> additional note:\n<ul>\n<li>\n<p>Please also note. If you looking for anything survey related you always will have updates of the <strong>sample_data</strong> and the <strong>survey</strong> table each time a participant sends a survey page (hits the Next/Continue button in a survey)</p>\n</li>\n<li>\n<p>You can always limit this (in CW logs) by the unique values for a participant (i.e. uid, lfdn, session_id).</p>\n</li>\n<li>\n<p>You also can look at the page if there are further things which could affect other tables (i.e. triggers on a page which are executed when sending the page or triggers on the follow up page which are executed \"directly\", which is more or less at the same time...)</p>\n<p> </p>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h1 id=\"h_01JAMY3QTZGN238T5JEQNAZBK0\">Summary</h1>\n<p>To effectively troubleshoot survey reply issues and master data updates, follow these steps:</p>\n<ul>\n<li>\n<strong>Step1: </strong>Use GUI or MariaDB to detect the exact timings of requests when a Specific User Filled a specific Survey</li>\n<li>\n<strong>Step 2</strong> Use MariaDB to trace survey replies via tables like <code>sample_data</code> and <code>survey_{{PID}}</code>.</li>\n<li>\n<strong>Step 3</strong>: Review AWS logs to track incomplete or failed connections that might have prevented survey data from being transferred.</li>\n<li>\n<strong>Step 4</strong>: Check Grafana PHP logs to identify errors during survey submission on PHP level.</li>\n<li>\n<strong>Step 5</strong>: Ensure that master data allocations are set up correctly and transferred properly by analyzing logs and database entries.</li>\n</ul>\n<hr>\n<h1 id=\"h_01JAMY3QTZYJB16XD0N1SS9YZ8\">FAQ</h1>\n<ol>\n<li>\n<p><strong>What if I can’t find a participant’s survey reply in the <code>sample_data</code> table?</strong></p>\n<ul>\n<li>Double-check the <code>uid</code>, <code>lfdn</code>, and <code>pid</code> used in your query. If the participant has not completed the survey, their entry may not appear in the <code>sample_data</code> table.</li>\n</ul>\n</li>\n<li>\n<p><strong>What causes master data allocation to fail?</strong></p>\n<ul>\n<li>Common causes include connection timeouts, errors in the PHP processing layer, or issues with the allocation setup in the survey configuration.</li>\n</ul>\n</li>\n<li>\n<p><strong>How do I find an incomplete survey session?</strong></p>\n<ul>\n<li>Search AWS logs for connection IDs that show a missing \"Quit\" event. These indicate that the participant's session was abandoned without completing the survey.</li>\n</ul>\n</li>\n</ol>",
    "user_segment_ids": [
        360000084973
    ]
}