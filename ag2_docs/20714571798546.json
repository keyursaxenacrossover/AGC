{
    "id": 20714571798546,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/20714571798546.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20714571798546-Cloned-Installations",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": true,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20714530860562,
    "created_at": "2024-08-12T16:47:55Z",
    "updated_at": "2024-08-12T16:47:57Z",
    "name": "Cloned Installations",
    "title": "Cloned Installations",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-08-12T16:47:57Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<p><b>Original Confluence URL:</b> <a href=\"https://qbdocs.atlassian.net/wiki/spaces/TS/pages/1053622522\">https://qbdocs.atlassian.net/wiki/spaces/TS/pages/1053622522</a> - please cross-check the quality of the ZD article with the Confluence counterpart and remove this line before publishing the ZD article</p>\n\n<h2>Table of Contents</h2>\n<ul class=\"toc\">\n<ul>\n<li><a href=\"#header-1\">Cloned Installations</a></li>\n<ul>\n<li><a href=\"#header-3\">Frankfurt/Bremen general info</a></li>\n<li><a href=\"#header-4\">Check a cloned installation</a></li>\n<li><a href=\"#header-5\">Special Installations</a></li>\n<ul>\n<li><a href=\"#header-7\">IPSOS Loyalty | EFM | CX</a></li>\n<li><a href=\"#header-8\">IPSOS ICP - NA</a></li>\n<li><a href=\"#header-9\">IPSOS SMX</a></li>\n<li><a href=\"#header-10\">Kantar (TNS)</a></li>\n</ul>\n<li><a href=\"#header-12\">Check a cloned shared installation to be used by different customer</a></li>\n<ul>\n<li><a href=\"#header-14\">Delete organisations and all related objects (projects, teams, users, mail templates, mail senders, etc.)</a></li>\n<ul>\n<li><a href=\"#header-16\">Find out all organisation related items</a></li>\n<li><a href=\"#header-17\">Get all team IDs of all users of an organisation</a></li>\n<li><a href=\"#header-18\">Get team name/ title of all users of an organisation</a></li>\n<li><a href=\"#header-19\">Clean up teams</a></li>\n<li><a href=\"#header-20\">Delete Questions from question library</a></li>\n<li><a href=\"#header-21\">Delete scale options that still are left (after having deleted organisations)</a></li>\n<li><a href=\"#header-22\">Delete projects that still are left (after having deleted organisations)</a></li>\n<li><a href=\"#header-23\">Delete mails from mail report that do not belong to the client's organisation</a></li>\n</ul>\n</ul>\n<li><a href=\"#header-26\">Clone Data Voyager</a></li>\n</ul>\n</ul>\n</ul><ac:parameter ac:name=\"maxLevel\">2</ac:parameter><p>also refer to: <ac:link ac:card-appearance=\"inline\"><ri:page ri:content-title=\"anonymise an installation\" ri:version-at-save=\"2\"></ri:page><ac:link-body>anonymise an installation</ac:link-body></ac:link> </p><h1 id=\"header-1\">Cloned Installations</h1><h2 id=\"header-3\">Frankfurt/Bremen general info</h2><ac:rich-text-body><p>non IPSOS Loyalty, non IPSOS ICP - NA, non IPSOS SMX, non Kantar</p></ac:rich-text-body><p>This process is not a standard but an exception and only is done after acknowledgement from Techsupport and System administration.</p><p>An existing installation should be copied within Bremen because the copy then should be used as new live/demo installation. The copy can be anonymised though.</p><ul>\n<li>\n<p>System Administration</p>\n<ul>\n<li><p>File system and database need to be copied</p></li>\n<li><p><ac:inline-comment-marker ac:ref=\"87935fd5-93c1-4525-9699-2493ce1f97f8\">anonymize </ac:inline-comment-marker>database (i.e. rename all email addresses to email+\"_invalid\")</p></li>\n<li><p>Rename paths and database and create tmp path</p></li>\n</ul>\n</li>\n<li>\n<p>Technical Support</p>\n<ul>\n<li><p>Check whether database has been renamed</p></li>\n<li><p>Adjust config and change tmp path, watchdog path and gp_id</p></li>\n<li><p>Execute installation check</p></li>\n<li><p>If a Data Voyager needs to be copied as well, see <a href=\"https://it.globalpark.de/twiki/bin/view/Support/StephanieBeckerEinarbeitungTS#02_06_2015_Copy_Clone_a_Data_Voy\">Copy/Clone a Data Voyager</a></p></li>\n<li><p>If MySight v2 projects were copied as well and have to be republished, see <a href=\"https://it.globalpark.de/twiki/bin/view/Support/MySight#MySight_new_Republish_MySight_pr\">republish MySight project</a></p></li>\n</ul>\n</li>\n</ul><h2 id=\"header-4\">Check a cloned installation</h2><ac:rich-text-body><p>Special Installations include: Kantar TNS, Ipsos Check <a href=\"https://qbdocs.atlassian.net/wiki/spaces/TS/pages/1053622522/Set+up+cloned+Installations#Special-Installations\">Special Installations</a> for these!</p></ac:rich-text-body><p>A live installation has been copied in Bremen and the copy is to be used as a new live installation for the same customer. The following things have to be kept in mind respectively need to be changed/checked:</p><ul>\n<li><p>System Administration has copied the installation, renamed the database and has changed the database information in the config file (database name and gp_name)</p></li>\n<li>\n<p>Technical Support has to change further settings and check the installation afterwards:</p>\n<ul>\n<li>\n<p>TS adds installation to Globis by executing script \"helpersAddInstallationInGlobis\"</p>\n<ul>\n<li><p>If not defined otherwise in the case, select 2 \"Kundeninstallation\"</p></li>\n<li><p>select corresponding QB country</p></li>\n<li><p>Enter Salesforce account ID and contact ID as mentioned in the installation request</p></li>\n<li>\n<p>The script already changes</p>\n<ul>\n<li><p>tmp_path</p></li>\n<li><p>tmp_path_export (please mind that Rackspace only has /nfs/export1/ and that needs to be changed manually in the config!)</p></li>\n<li><p>watchdog_path</p></li>\n<li><p>gp_id</p></li>\n<li><p>the root password and prints it out on the console</p></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>TS adds additional modules if requested</p></li>\n<li><p>Login to installation using the root account</p></li>\n<li>\n<p>Check for modified variables and whether further paths needs to be adjusted to the new domain e.g.</p>\n<ul>\n<li><p>upload path</p></li>\n<li><p>relevantid_auth</p></li>\n<li><p>session DB</p></li>\n<li><p>intermediate DB for <a href=\"https://it.globalpark.de/twiki/bin/view/Support/MySight\">EFS Mysight</a> v2</p></li>\n<li><p>export path (in case of Rackspace it needs to be /nfs/export1)</p></li>\n</ul>\n</li>\n<li><p>Add root password to password safe</p></li>\n<li>\n<p>Reset activity stream to create the elastic search index for this installation</p>\n<ul>\n<li><p>go to <strong>www</strong> folder</p></li>\n<li>\n<p>execute <strong>php support/panel_reset_activitystream.php</strong> =&gt; [ 1 ] - Delete and reset complete activity stream [WARNING: maybe slow]) </p>\n<ul><li><p>the script doesn´t end by itself. Kill with STRG + c when done</p></li></ul>\n</li>\n<li>\n<p>Optional check  -&gt; Look for <strong>yellow open</strong></p>\n<pre><code class=\"language-bash\">curl -XGET --silent 'http://elasticsearch.[ab1234].svc.cluster.local:9200/_cat/indices?v' | awk 'NR&gt;1 {print \"Health: \"$1\"\\n\" \"Status: \"$2\"\\n\" \"Index: \"$3\"\\n\" \"Pri: \"$4\"\\n\" \"Rep: \"$5\"\\n\" \"Docs count: \"$6\"\\n\" \"Docs deleted: \"$7\"\\n\" \"Store size: \"$8\"\\n\" \"Pri store size: \"$9}'</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul><p>If Data Voyagers were cloned as well, they have to be checked, too. Please see step Clone a Data Voyager.</p><hr><h2 id=\"header-5\">Special Installations</h2><h3 id=\"header-7\">IPSOS Loyalty | EFM | CX</h3><p>The process for Ipsos Loyalty has been evolved already and all employees (Tech Support and Sysadmins) already should know about it.<br>Here is a documentation on how to set them up:</p><ul>\n<li><p>Christian fills out a survey to request the IPSOS EFM installation (<a href=\"https://ww2.efs-survey.com/uc/main/73d5/\">https://ww2.efs-survey.com/uc/main/73d5/</a> ,\"Ipsos Order Form_DO NOT DELETE\")</p></li>\n<li><p>The installation is a clone of <a href=\"http://tk1309.customervoice360.com\"><strong>tk1309.customervoice360.com</strong></a> (if not defined otherwise)</p></li>\n<li><p>A support case is created at our 1st Level Support</p></li>\n<li><p>1st Level Support forwards the support case to Sysadmins so they create the installation (they copy a master installation)</p></li>\n<li><p>Sysadmins pass the case to Techsupport</p></li>\n<li>\n<p>Use \"helpersAddInstallationInGlobis\" to add the new installation to Globis and select \"CUSTOMER-IPSOS\"</p>\n<ul><li><p>The script will ask for needed information and will print out a ToDo list</p></li></ul>\n</li>\n<li><p>Make sure to complete all !ToDos including granting mentioned users SiteAdmin rights on preprod2</p></li>\n<li>\n<p>Reset activity stream to create the elastic search index for this installation</p>\n<ul>\n<li><p>go to <strong>www</strong> folder</p></li>\n<li>\n<p>execute <strong>php support/panel_reset_activitystream.php</strong> =&gt; [ 1 ] - Delete and reset complete activity stream [WARNING: maybe slow]) </p>\n<ul><li><p>the script doesn´t end by itself. Kill with STRG + c when done</p></li></ul>\n</li>\n<li>\n<p>Optional check  -&gt; Look for <strong>green open</strong></p>\n<pre><code class=\"language-bash\"> curl --silent -XGET 'http://elasticsearch:9200/_cat/indices?v' | grep opst_ab1234</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>Sync the panelists (optional if panelists exist)</p>\n<ul><li><p><strong>php support/panel_sync_panelists.php</strong> =&gt; [ 0 ] - Update all panelists [WARNING: maybe slow])</p></li></ul>\n</li>\n<li><p>Forward the case to the corresponding 1st Level</p></li>\n</ul><p><br></p><div class=\"expand-macro\">\n<h4 string=\"To do IPSOS EFM\"></h4>\n<p>[] Check config due to new paths and if necessary all other values<br>[] Execute installation check (currently only valid for EFS and DV 1.1)<br>[] Did you changed the root password?<br>[] Safe the new password in our password safe on the server dili</p>\n<p>___IPSOS SPECIALS___<br>TWIKI-LINK: <a href=\"https://it.globalpark.de/twiki/bin/view/Support/CHDDocumentationCustomerSpecialsIpsos\">https://it.globalpark.de/twiki/bin/view/Support/CHDDocumentationCustomerSpecialsIpsos</a></p>\n<p>[] Was the name of the organisation in EFS replaced from \"IPSOS - master installation master installation\" to something like this: \" IPSOS [Ipsos client name] [Client project name]\"<br>[] Did the script replace the old token \"***\" to this new token \"***\". You check it by doing this: select \\* from efs_service_token<br>[] Add Ipsos members as site administrators for this site on PREPROD2. For more Details see case description.</p>\n<p><br>__TODO__ FIRST LEVEL</p>\n<p>[] Send information concerning the new token \"***\" to the client (holger.hetterling@<a href=\"http://ipsos.com\">ipsos.com</a>)<br>[] Send information to <a href=\"mailto:gordon.fiedler@questback.com\">gordon.fiedler@questback.com</a>, <a href=\"mailto:johannes.hubrich@questback.com\">johannes.hubrich@questback.com</a>, <a href=\"mailto:christian.kamp@questback.com\">christian.kamp@questback.com</a><br>[] Send information to customer, Contact person that will receive confirmation that the EFS instance is ready (no login information and no account to be created!)<br>[] CHD contacts the client (holger.hetterling@<a href=\"http://ipsos.com\">ipsos.com</a>, <a href=\"mailto:christian.demel@ipsos.com\">christian.demel@ipsos.com</a>) The access data are the same like the data on the master.<br>[] If MySight had been requested add the ACL rights 'mysight_self_siteadmin' and 'mysight_text_dimension' (read/write) to the team 'MySight'<br>[] Send out access data for MySight users. Use mail templates below</p>\n</div><div class=\"expand-macro\">\n<h4 string=\"Mail Template Mysight Data\"></h4>\n<p>Account name and URL:</p>\n<p>Dear [Firstname],</p>\n<p>We have created a user account for you to access the Questback MySight environment via “<a href=\"https://mysight-preprod2.questback.com\">https://mysight-preprod2.questback.com</a>” (Site: [site].<a href=\"http://customervoice360.com\">customervoice360.com</a>).</p>\n<p>Username: [username]<br>Password: will be sent separately</p>\n<p>Please change your password after your first login ([YOUR USER] / Drop Down Menu, Top Right &gt; My Account Settings).<br>If there are any problems with your permissions, please don’t hesitate to contact our support team (de.support@<a href=\"http://questback.com\">questback.com</a>).</p>\n<p>Best regards</p>\n<p><br>Password:</p>\n<p>Dear [Firstname],</p>\n<p>Your password to access the Questback MySight environment via “<a href=\"https://mysight-preprod2.questback.com\">https://mysight-preprod2.questback.com</a>” is</p>\n<p>[Password]</p>\n<p>Please change your password after your first login ([YOUR USER] / Drop Down Menu, Top Right &gt; My Account Settings).<br>If there are any problems with your permissions, please don’t hesitate to contact our support team (de.support@<a href=\"http://questback.com\">questback.com</a>).</p>\n<p>Best regards,</p>\n</div><h3 id=\"header-8\">IPSOS ICP - NA</h3><p>The set up process hasn't been discussed fully yet.<br>We currently only know that the installation has to be set up within 3 business days and has to be a copy of master installation <a href=\"http://eb3684.customervoice360.com\"><strong>eb3684.customervoice360.com</strong></a> <br>The good thing about this is that there are not special programmings.<br>The drawback is that the master installation already has some inconsistencies that are copied to the cloned installation as well. This has to be cleaned by US customer support.<br></p><ul>\n<li><p>Installation needs to be requested via survey</p></li>\n<li><p>Technical Support forwards the case to Sysadmin</p></li>\n<li><p>Sysadmins will clone the defined master installation and send case back to TS</p></li>\n<li>\n<p>TS adds installation to Globis by executing script \"helpersAddInstallationInGlobis\" in htdocs without parameters</p>\n<ul>\n<li><p>select 2 \"Kundeninstallation\"</p></li>\n<li><p>select \"QB_US\" as responsible country</p></li>\n<li><p>Enter Salesforce account ID and contact ID as mentioned in the installation request</p></li>\n<li>\n<p>The script already changes</p>\n<ul>\n<li><p>tmp_path</p></li>\n<li><p>tmp_path_export</p></li>\n<li><p>watchdog_path</p></li>\n<li><p>gp_id</p></li>\n<li><p>the root password and prints it out on the console</p></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>TS adds additional modules if requested</p></li>\n<li><p>TS changes the service layer token (because it is copied from the master too)</p></li>\n<li><p>In case of Rackspace: TS changes memcache URL to \"172.24.48.112\"</p></li>\n<li><p>In case of Rackspace: TS changes sftp_host to \"172.24.48.40\"</p></li>\n<li><p>In case of Rackspace: TS changes mysight_user_provisioning_service to \"<a href=\"http://172.24.48.40:49866/app/api/process/userprovision/\">http://172.24.48.40:49866/app/api/process/userprovision/</a>\"</p></li>\n<li><p>TS renames organisation from \"Ipsos ICP - MASTER INSTALLATION\" to \"Ipsos ICP - NA\".</p></li>\n<li><p>TS changes \"qb only:: Customer ID\" to 001D000001r2iZ6 (if not defined otherwise in the request)</p></li>\n<li><p>TS executes healself</p></li>\n<li><p>TS resets activity stream to create the elastic search index for this installation (php support/panel_reset_activitystream.php =&gt; [ 1 ] - Delete and reset complete activity stream [WARNING: maybe slow])</p></li>\n<li><p>TS also might have to sync the panelists (php support/panel_sync_panelists.php =&gt; [ 0 ] - Update all panelists [WARNING: maybe slow])</p></li>\n<li><p>TS adds the installation to US PasswordSafe and adds the password created by the script before</p></li>\n<li><p>TS executes installation check</p></li>\n</ul><p></p><h3 id=\"header-9\">IPSOS SMX</h3><p>The new installation is a copy of master installation <a href=\"http://jm1268.customervoice360.com\"><strong>jm1268.customervoice360.com</strong></a> if not defined otherwise.<br>No special deadline defined, so installation should be set up within 6 working days.</p><p></p><ul>\n<li><p>Technical Support forwards the case to Sysadmin</p></li>\n<li><p>Sysadmins will clone the defined master installation and send case back to TS</p></li>\n<li>\n<p>TS adds installation to Globis by executing script <strong>helpersAddInstallationInGlobis</strong></p>\n<ul>\n<li><p>select 2 <strong>Kundeninstallation</strong></p></li>\n<li><p>select <strong>QB_US</strong> as responsible country</p></li>\n<li><p>Enter Salesforce account ID and contact ID as mentioned in the installation request</p></li>\n<li>\n<p>The script already changes</p>\n<ul>\n<li><p>tmp_path</p></li>\n<li><p>tmp_path_export</p></li>\n<li><p>watchdog_path</p></li>\n<li><p>gp_id</p></li>\n<li><p>the root password and prints it out on the console</p></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>TS adds the installation to US PasswordSafe and adds the password created by the script before</p></li>\n<li><p>TS adds additional modules if requested</p></li>\n<li><p>TS \"changes the service layer token\" (because it is copied from the master too)</p></li>\n<li>\n<p>In case of Rackspace: TS changes</p>\n<ul>\n<li><p><strong>memcache_servers</strong> -&gt; 172.24.48.112</p></li>\n<li><p><strong>sftp_host</strong> -&gt; 172.24.48.40</p></li>\n<li><p><strong>mysight_user_provisioning_service</strong> -&gt; <a href=\"http://172.24.48.40:49866/app/api/process/userprovision/\">http://172.24.48.40:49866/app/api/process/userprovision/</a></p></li>\n<li><p>(if not done by admins already) <strong>$_SERVER[\"SERVER_PORT\"]</strong> in EFS configuration file (config.inc.php3) -&gt; 8443 // Frankfurt: 443</p></li>\n</ul>\n</li>\n<li><p>TS adds correct Salesforce ID to Organizations \"SMX_Admin\" and \"Ipsos SMX\"</p></li>\n<li><p>TS executes healself</p></li>\n<li>\n<p>TS resets activity stream to create the elastic search index for this installation</p>\n<pre><code class=\"language-sql\">cd www\nphp support/panel_reset_activitystream.php =&gt; [ 1 ] - Delete and reset complete activity stream [WARNING: maybe slow]</code></pre>\n</li>\n<li>\n<p>TS also might have to sync the panelists</p>\n<pre><code class=\"language-sql\">cd www/\nphp support/panel_sync_panelists.php =&gt; [ 0 ] - Update all panelists [WARNING: maybe slow]</code></pre>\n</li>\n<li><p>TS executes installation check</p></li>\n</ul><h3 id=\"header-10\">Kantar (TNS)</h3><p>The process and especially keeping the deadline currently still is in discussion because there are going to be different types of installations.<br>Based on the type of installation, a different set of modules and customizings will be enabled. <br>Important for EFS TS: You have to execute script \"helpersCreateNewInstallation\" because we don't have a master installation yet. When executing the script, select \"used_by: TNS\". </p><p></p><ul>\n<li><p>195.66.99.177 - IP for Kantar installations with <a href=\"https://it.globalpark.de/twiki/bin/view/Support/SSL\">SSL</a></p></li>\n<li><p>195.66.99.233 - deafult-IP for Kantar Installations without <a href=\"https://it.globalpark.de/twiki/bin/view/Support/SSL\">SSL</a></p></li>\n<li><p><a href=\"http://subdomain.mypersonalroutine.com.edgekey.net\">subdomain.mypersonalroutine.com.edgekey.net</a> - Example Domain for Installations using Akamai</p></li>\n</ul><hr><h2 id=\"header-12\">Check a cloned shared installation to be used by different customer</h2><p><em><strong>How to delete objects of other clients on new installation</strong></em></p><p>Example case 00460199<br>In this example shared installation <a href=\"http://ww3.efs-survey.com\">ww3.efs-survey.com</a> was cloned to be used by client ING-DiBa. On the cloned installation all data and objects of the other clients needs to be deleted.<br>Here is how you can delete these objects.</p><ac:parameter ac:name=\"minLevel\">4</ac:parameter><h3 id=\"header-14\">Delete organisations and all related objects (projects, teams, users, mail templates, mail senders, etc.)</h3><ul>\n<li><p>Delete all organisations of all other clients on the cloned installation. If everything was set up without inconsistencies, all related objects projects, teams, users, mail templates, mail senders, etc. will be deleted with the organization. If there are nconsistencies, these have to be cleaned afterwards.</p></li>\n<li>\n<p>Fix inconsistencies afterwards: </p>\n<ul><li><p>[installation path]/htdocs/www<br>php support/fix_inconsistencies.php</p></li></ul>\n</li>\n</ul><h4 id=\"header-16\">Find out all organisation related items</h4><p>Find out all organisatzion related items, like projects, macros, scale options etc see list in SELECT below:</p><pre><code class=\"language-sql\">SELECT d.gid, d.rc, oi.*, ot.tname FROM obj_inst oi, obj_type ot, obj_type ot2, drago d WHERE d.gid IN (120276) AND ot.tname IN('project_cat','project','sy_theme','scala','macro','mail_preview','sy_msg_set','mail_sender','layout_template','acl_template','bib_cat','exchange_files','flash_template','survey_reportfile','orbit_snapshot') AND d.oid=oi.oid AND oi.tid=ot.tid AND ot.tid_2=ot2.tid AND ot2.tname!=\"acl\" ORDER BY d.gid;</code></pre><h4 id=\"header-17\">Get all team IDs of all users of an organisation</h4><pre><code class=\"language-sql\">SELECT DISTINCT gid FROM user_grp WHERE uid in (select uid from admin_user_contract where org=[ORGANISATION ID]) GROUP BY gid;</code></pre><h4 id=\"header-18\">Get team name/ title of all users of an organisation</h4><pre><code class=\"language-sql\">SELECT DISTINCT gid FROM user_grp WHERE uid in (select uid from admin_user_contract where org=[ORGANISATION ID]) GROUP BY gid;</code></pre><h4 id=\"header-19\">Clean up teams</h4><ul>\n<li><p>Login with sysadmin account and list all etams in menu System &gt;&gt; Users &gt;&gt; Teams</p></li>\n<li><p>Compare this list with the database</p></li>\n</ul><pre><code class=\"language-sql\">SELECT gid, gname, gtitle FROM groups;</code></pre><ul>\n<li><p>If there are teams that are not shown in the GUI, copy their ID from the database</p></li>\n<li><p>Open any team in the GUI and replace the oid in the URL with the above copied one</p></li>\n<li><p>Delete the team via the corresponding button</p></li>\n<li><p>Repeat for other teams</p></li>\n</ul><h4 id=\"header-20\">Delete Questions from question library</h4><ul><li><p>Get list of categories in question library that the client's teams do not have access to (that only sysadmin has access to)</p></li></ul><pre><code class=\"language-sql\">SELECT d.gid, d.rc, oi.*, ot.tname FROM obj_inst oi, obj_type ot, obj_type ot2, drago d WHERE d.gid NOT IN (1195,9051) AND ot.tname IN('bib_cat') AND d.oid=oi.oid AND oi.tid=ot.tid AND ot.tid_2=ot2.tid AND ot2.tname!=\"acl\" ORDER BY d.gid;</code></pre><h4 id=\"header-21\">Delete scale options that still are left (after having deleted organisations)</h4><p>Create an account in the teams of the client that owns the cloned installation. Also add this account to the organization of the client. Don't use a Questback email address.<br>Login with this account to see which scale options the client can see and which belong to them.<br>Copy the visible scids (scale IDs).</p><pre><code class=\"language-sql\">SELECT COUNT(*) FROM scala_def WHERE scid NOT IN ([previously copied scids]);\nDELETE FROM scala_def WHERE scid NOT IN ([previously copied scids]);\n\nSELECT COUNT(*) FROM scala_value WHERE scid NOT IN ([previously copied scids]);\nDELETE FROM scala_value WHERE scid NOT IN ([previously copied scids]);</code></pre><h4 id=\"header-22\">Delete projects that still are left (after having deleted organisations)</h4><p>Create an account in the teams of the client that owns the cloned installation. Also add this account to the organization of the client. Don't use a Questback email address.<br>Login with this account to see which projects the client can see and which belong to them.</p><ul><li><p>Find out Ids of remaining organisatzions (client, default and Questback)</p></li></ul><pre><code class=\"language-sql\">SELECT id, name, description FROM admin_contract_org;</code></pre><ul><li><p>Create backup table of project Ids (will be used for two different cases)</p></li></ul><pre><code class=\"language-sql\">CREATE TABLE backup_pid (pid INT NOT NULL);</code></pre><ul><li><p>Find out projects that are assigned to a deleted organisation (i.e- are assigned to an organisation that no longer exists = e.g. NOT IN (1 (default) ,9 (client organisation), 146 (QB_DE) )</p></li></ul><pre><code class=\"language-sql\">SELECT count(po.pid) FROM project_org po JOIN project p ON (po.pid=p.pid) WHERE oid NOT IN (1,9,146);\nSELECT p.pid FROM project_org po JOIN project p ON (po.pid=p.pid) WHERE oid NOT IN (1,9,146);</code></pre><ul><li><p>Add these pids to the backup table</p></li></ul><pre><code class=\"language-sql\">INSERT INTO backup_pid (SELECT p.pid FROM project_org po JOIN project p ON (po.pid=p.pid) WHERE oid NOT IN (1,9,146));</code></pre><ul><li><p>Create a new organisation (\"delete_me\") and assign all remaining projects of deleted organisations to this one.</p></li></ul><pre><code class=\"language-sql\">UPDATE project_org SET oid=[ID of \"delete_me\"] WHERE pid IN (SELECT pid FROM backup_pid);</code></pre><ul><li><p>Find out how many projects are assigned to organisation \"delete_me\" and to which only the root team has access to</p></li></ul><pre><code class=\"language-sql\">SELECT COUNT(pid) FROM (SELECT pid, ptitle, group_concat(gname) AS tmp FROM project JOIN drago ON (pid=oid) JOIN groups USING (gid) GROUP BY pid) AS tables JOIN project_org USING (pid) JOIN admin_contract_org ON (id=oid) WHERE tmp=\"root\" AND name=\"delete_me\";</code></pre><ul><li><p>Double check one example</p></li></ul><pre><code class=\"language-sql\">SELECT pid, ptitle AS Projekttitel, name AS Organisation, tmp AS Team FROM (SELECT pid, ptitle, group_concat(gname) AS tmp FROM project JOIN drago ON (pid=oid) JOIN groups USING (gid) GROUP BY pid) AS tables JOIN project_org USING (pid) JOIN admin_contract_org ON (id=oid) WHERE tmp=\"root\" AND name=\"delete_me\" limit 1;</code></pre><ul><li><p>Delete from backup table</p></li></ul><pre><code class=\"language-sql\">DELETE FROM backup_pid;</code></pre><ul><li><p>Add projects that are assigned to \"delete_me\" but only root team has access to to backup table</p></li></ul><pre><code class=\"language-sql\">INSERT INTO backup_pid (SELECT pid FROM (SELECT pid, ptitle, group_concat(gname) AS tmp FROM project JOIN drago ON (pid=oid) JOIN groups USING (gid) GROUP BY pid) AS tables JOIN project_org USING (pid) JOIN admin_contract_org ON (id=oid) WHERE tmp=\"root\" AND name=\"delete_me\");</code></pre><ul><li>\n<p>Check how many drago entries there are for the projects in the backup table. If there are projects with more than one entry, this means that there are inconsistencies</p>\n<p>and there is more than one team that has access to this project. These teams though already might have been deleted (that is the inconsistency!)</p>\n</li></ul><pre><code class=\"language-sql\">SELECT COUNT(oid), oid FROM drago WHERE oid IN (SELECT pid FROM backup_pid) GROUP BY oid HAVING COUNT(oid)&gt;1;</code></pre><ul><li><p>View these entries</p></li></ul><pre><code class=\"language-sql\">SELECT * FROM drago WHERE oid IN ([oids from above select]) ORDER BY oid;</code></pre><ul>\n<li><p>Copy gid of the output where gid is = 2 (root team) and manually open these teams in the GUI:</p></li>\n<li><p>Open any team, change the oid in the URL and check the team. If it can be viewed via the GUI, try to delete it via corresponding button.</p></li>\n<li><p>On the database check the drago enties again:</p></li>\n</ul><pre><code class=\"language-sql\">SELECT * FROM drago WHERE oid IN ([oids from above select]) ORDER BY oid;</code></pre><ul>\n<li><p>You only should see entries for oid=2</p></li>\n<li><p>Change access rights to the projects that are assigned to \"delete_me\"/backup table to a new team that you've created in the GUI (\"delete_me\")</p></li>\n</ul><pre><code class=\"language-sql\">UPDATE drago SET gid=[group Id of team\"delete_me\"] WHERE gid=2 AND oid IN (SELECT pid FROM backup_pid);</code></pre><ul><li><p>Find out how many projects are assigned to organisation \"delete_me\" and that have drago entries but for teams that no longer exist</p></li></ul><pre><code class=\"language-sql\">SELECT COUNT(pid) FROM project LEFT JOIN drago ON (pid=oid) WHERE rc IS NULL;</code></pre><ul><li><p>If there are results, add these projects to backup table</p></li></ul><pre><code class=\"language-sql\">DELETE FROM backup_pid;\nINSERT INTO backup_pid (SELECT pid FROM project LEFT JOIN drago ON (pid=oid) WHERE rc IS NULL);</code></pre><ul><li><p>Change access rights for these projects to team \"delete_me\"</p></li></ul><pre><code class=\"language-sql\">INSERT INTO drago SET gid=[group Id of team\"delete_me\"], oid=[pid from backup table], rc=3;</code></pre><ul><li><p>Find out how many projects are assigned to organisation \"delete_me\" and that have drago entries but for teams that no longer exist</p></li></ul><pre><code class=\"language-sql\">SELECT COUNT(po.pid) FROM project_org po JOIN drago d ON (po.pid=d.oid) LEFT JOIN groups g ON (g.gid=d.gid) WHERE po.oid=6 AND g.gid IS NULL;</code></pre><ul><li><p>If there are results, add these projects to backup table</p></li></ul><pre><code class=\"language-sql\">INSERT INTO backup_pid(SELECT po.pid FROM project_org po JOIN drago d ON (po.pid=d.oid) LEFT JOIN groups g ON (g.gid=d.gid) WHERE po.oid=342 AND g.gid IS NULL);</code></pre><ul><li><p>Change access rights for these projects to team \"delete_me\"</p></li></ul><pre><code class=\"language-sql\">UPDATE drago SET gid=[group Id of team\"delete_me\"] WHERE oid IN (SELECT pid FROM backup_pid);</code></pre><ul>\n<li><p>Check organisation and assigned projects via the GUI.</p></li>\n<li><p>(Finally) delete organisation (and hopefully) all assigned teams (\"delete_me\"), users and projects via the GUI.</p></li>\n</ul><h4 id=\"header-23\">Delete mails from mail report that do not belong to the client's organisation</h4><ul><li><p>Find out how many mails there are that do not belong to the client's organisation (mails that were not already deleted by deleting the organisation)</p></li></ul><pre><code class=\"language-sql\">SELECT count(mail_id) FROM mail_prot AS p LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '2') AND po.oid!=[organisation Id of client];\nSELECT count(p.mail_id) FROM mail_prot AS p LEFT JOIN mail_text AS mt ON(p.text_hash=mt.hash) LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '1') AND po.oid!=[organisation Id of client];</code></pre><ul><li><p>To which origanisations do these mail IDs belong to? You can ignore these if they only belong to Questback</p></li></ul><pre><code class=\"language-sql\">SELECT mail_id, po.oid FROM mail_prot AS p LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '2') AND po.oid!=[organisation Id of client];\nSELECT p.mail_id, po.oid FROM mail_prot AS p LEFT JOIN mail_text AS mt ON(p.text_hash=mt.hash) LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '1') AND po.oid!=[organisation Id of client];</code></pre><ul><li><p>Delete found mails_ids that do not belong to client or Questback from mail_prot and mail_text</p></li></ul><pre><code class=\"language-sql\">CREATE TABLE backup_mails (mail_id int NOT NULL, text_hash varbinary(32) NOT NULL);\nINSERT INTO backup_mails (SELECT mail_id, text_hash FROM mail_prot AS p LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid)  WHERE (p.id_type &amp; '2') AND po.oid!=[organisation Id of client] AND po.oid!=[Questback organisation id]);\nDELETE FROM mail_prot WHERE mail_id IN (SELECT mail_id FROM backup_mails);\nDELETE FROM mail_text WHERE hash IN (SELECT text_hash FROM backup_mails);</code></pre><hr><h2 id=\"header-26\">Clone Data Voyager</h2><p>If a Data Voyager has been copied. This is how you adjust the copy.</p><p>Please mind that copied DVs are in an undefined status because we currently do not have any experience with</p><p>what effects missing/empty fastbit partitions have. The requester has to check the DV afterwards. If it is not functional, it has to be set up a new.</p><div class=\"expand-macro\">\n<h4 string=\"Checklist:\"></h4>\n<p>[] Check application.ini to see whether the correct database data and folders are set<br>[] Login to DV using the root account and add the database of the copied installation as a source.<br>[] Delete existing projects in DV<br>[] Add Data Voyager to Globis (using \"helpersAddInstallationInGlobis\" in the dv folder)<br>[] Create a new root password (using script dv/support/changeRootPw.php)<br>[] Add Data Voyager and root password to PasswordSafe?<br>[] adjust table \"ehr_reporting_fastbit_partitions\":<br>* Add the domain in column \"client\".<br>* Add the customer_path in column \"product\"</p>\n</div>",
    "user_segment_ids": [
        360000084973
    ]
}