{
    "id": 20717160816146,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/20717160816146.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20717160816146-OKTA-tenant-switch-questback-access-to-tivian-access",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": true,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20714711445138,
    "created_at": "2024-08-12T20:19:13Z",
    "updated_at": "2024-08-12T20:19:39Z",
    "name": "OKTA tenant switch (questback.access to tivian.access)",
    "title": "OKTA tenant switch (questback.access to tivian.access)",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-08-12T20:19:39Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<p><b>Original Confluence URL:</b> <a href=\"https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/3511844878\">https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/3511844878</a> - please cross-check the quality of the ZD article with the Confluence counterpart and remove this line before publishing the ZD article</p>\n\n<h2>Table of Contents</h2>\n<ul class=\"toc\">\n<ul>\n<li><a href=\"#header-1\">What needs to be done:</a></li>\n<ul>\n<li><a href=\"#header-3\">1. execute support/iam/migration.php</a></li>\n<li><a href=\"#header-4\">2. execute support/iam/okta2okta.php</a></li>\n<li><a href=\"#header-5\">3. deactivate SSO module</a></li>\n<li><a href=\"#header-6\">4. swap iam config variables in system configuration of installation</a></li>\n<li><a href=\"#header-7\">5. swap iam_reference tables</a></li>\n<li><a href=\"#header-8\">6. re-activate SSO module</a></li>\n<li><a href=\"#header-9\">7. run final test</a></li>\n</ul>\n</ul>\n</ul><p></p><ac:parameter ac:name=\"panelIcon\">:warning:</ac:parameter><ac:parameter ac:name=\"panelIconId\">atlassian-warning</ac:parameter><ac:parameter ac:name=\"bgColor\">#FF8F73</ac:parameter><ac:rich-text-body><p>these steps assume that Tivian Access has been successfully configured, tested and confirmed by customer or intern check with a test user, do not proceed if any of those points are not applicable, for more information see <ac:link ac:card-appearance=\"inline\"><ri:page ri:content-title=\"Questback - Tivian Domain Migration Steps\" ri:version-at-save=\"24\"></ri:page><ac:link-body>Questback - Tivian Domain Migration Steps</ac:link-body></ac:link> </p></ac:rich-text-body><h1 id=\"header-1\">What needs to be done:</h1><h2 id=\"header-3\">1. execute support/iam/migration.php</h2><p>move into i [technical name] &amp; cd www</p><p>or </p><p>cd /nfs/installations/[technicalname]/nfs/opst/[technicalname].customervoice360.com/htdocs/www</p><pre><code class=\"language-text\">storck_nikolaus@servicegw-prod-us-02:[/nfs/installations/cg9217/nfs/opst/cg9217.customervoice360.com/htdocs/www]\n$ php support/iam/migration.php\nWhat do you want to do?\n[1] Admin user migration\n[2] Portal migration\n[3] Admin users activation\n[4] Portal ClientGroup migration\n[5] User ClientGroup migration\n[6] Convert admin user from questback.com to tivian.com domain\n[7] Convert panelists from questback.com to tivian.com domain\n[8] Exit</code></pre><p>run [1], [5] &amp; [6] always; </p><ac:adf-extension><ac:adf-node type=\"decision-list\"><ac:adf-attribute key=\"local-id\">1b364d65-ccda-42df-9621-f8e5b25e702c</ac:adf-attribute><ac:adf-node type=\"decision-item\"><ac:adf-attribute key=\"local-id\">ae948044-386c-4955-9e2a-39acc05f91a1</ac:adf-attribute><ac:adf-attribute key=\"state\">DECIDED</ac:adf-attribute><ac:adf-content>[2], [4] &amp; [7] only if ‘Portal’ module is active</ac:adf-content></ac:adf-node></ac:adf-node><ac:adf-fallback><ul class=\"decision-list\"><li>[2], [4] &amp; [7] only if ‘Portal’ module is active</li></ul></ac:adf-fallback></ac:adf-extension><h2 id=\"header-4\">2. execute support/iam/okta2okta.php</h2><p></p><pre><code class=\"language-text\">storck_nikolaus@servicegw-prod-us-02:[/nfs/installations/zv1045/nfs/opst/zv1045.customervoice360.com/htdocs/www]\n$ php support/iam/okta2okta.php\nCurrent Okta Application touchstone zv1045.customervoice360.com EFS is reachable\n---------------------------------------------------------------------------------------------------------------------\n|key                |current Okta                                                                                   |\n---------------------------------------------------------------------------------------------------------------------\n|iam_well_known_url |https://access.questback.com/oauth2/aus5unxrk4xoGqlPI416/.well-known/oauth-authorization-server|\n|iam_api_token      |008c4oTSR3RtUGKfYb8Ovdhq02NkkJ_nGYF8b4Hgux                                                     |\n|iam_client_id      |0oa1b3aqwarB1GZEo417                                                                           |\n|iam_client_secret  |7Ghpssp7uKoqu6Nh-LMJl0-CtAMcurJ9Lq-PaTO9                                                       |\n|iam_client_group_id|00g1b35shx3DlmUSK417                                                                           |\n|iam_user_group_id  |00g5upo0tuL3KdYOA416                                                                           |\n|iam_proxy_url      |http://squid.global-services.svc.cluster.local:8080                                            |\n---------------------------------------------------------------------------------------------------------------------\nPlease specify the config for access to new Okta\niam_well_known_url  [https://access.tivian.com/.well-known/openid-configuration]:\niam_api_token       [008c4oTSR3RtUGKfYb8Ovdhq02NkkJ_nGYF8b4Hgux]:\niam_client_id       [0oa1b3aqwarB1GZEo417]:\niam_client_secret   [7Ghpssp7uKoqu6Nh-LMJl0-CtAMcurJ9Lq-PaTO9]:\niam_client_group_id [00g1b35shx3DlmUSK417]:\niam_user_group_id   [00g5upo0tuL3KdYOA416]:\niam_proxy_url       [http://squid.global-services.svc.cluster.local:8080]:</code></pre><table data-layout=\"wide\" ac:local-id=\"723c5ecb-ecb6-4759-b41e-871c20b80f0b\">\n<colgroup>\n<col>\n<col style=\"width: 258.0px;\">\n<col style=\"width: 453.0px;\">\n<col style=\"width: 207.0px;\">\n</colgroup>\n<tbody>\n<tr>\n<th class=\"numberingColumn\"></th>\n<th><p><strong>config variable</strong></p></th>\n<th><p><strong>click path in OKTA</strong></p></th>\n<th><p><strong>notes</strong></p></th>\n</tr>\n<tr>\n<td class=\"numberingColumn\">1</td>\n<td><p><code>iam_well_known_url</code></p></td>\n<td><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717171206802\" alt=\"image-20220503-145713.png\"></td>\n<td><p></p></td>\n</tr>\n<tr>\n<td class=\"numberingColumn\">2</td>\n<td><p>#iam_api_token</p></td>\n<td><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717178965394\" alt=\"image-20220503-150320.png\"></td>\n<td><p>save new token in password safe!</p></td>\n</tr>\n<tr>\n<td class=\"numberingColumn\">3</td>\n<td><p><code>iam_client_id</code> <br>&amp;<br><code>iam_client_secret</code> </p></td>\n<td><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717171109138\" alt=\"image-20220503-151927.png\"></td>\n<td><p>check if Client ID &amp; Client Secret are present in password safe</p></td>\n</tr>\n<tr>\n<td class=\"numberingColumn\">4</td>\n<td><p><code>iam_client_group_id</code></p></td>\n<td>\n<img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717151046546\" alt=\"image-20220503-152523.png\"><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717178751378\" alt=\"image-20220503-152528.png\">\n</td>\n<td><p>this is the <strong>superior </strong>group without a technical name in its name</p></td>\n</tr>\n<tr>\n<td class=\"numberingColumn\">5</td>\n<td><p><code>iam_user_group_id</code></p></td>\n<td><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717150923026\" alt=\"image-20220503-152818.png\"></td>\n<td><p>this is the installation-specific group id</p></td>\n</tr>\n<tr>\n<td class=\"numberingColumn\">6</td>\n<td><p><code>iam_proxy_url</code></p></td>\n<td><p>-</p></td>\n<td><p>does not change (for now), use the same</p></td>\n</tr>\n</tbody>\n</table><h2 id=\"header-5\">3. deactivate SSO module</h2><pre><code class=\"language-text\">helpersEfsChangeConfig iam_module_active 0</code></pre><h2 id=\"header-6\">4. swap iam config variables in system configuration of installation</h2><table data-layout=\"default\" ac:local-id=\"3e9983cc-f00c-4115-aa60-c7303055e25f\">\n<colgroup>\n<col style=\"width: 340.0px;\">\n<col style=\"width: 340.0px;\">\n</colgroup>\n<tbody>\n<tr>\n<th><p style=\"text-align: center;\"><strong>config variable</strong></p></th>\n<th><p style=\"text-align: center;\"><strong>needs to be changed</strong></p></th>\n</tr>\n<tr>\n<td><p>iam_admin_bypass_login_route</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_api_token\t \t\t\t\t\t</p></td>\n<td><p style=\"text-align: center;\">yes</p></td>\n</tr>\n<tr>\n<td><p>iam_audience\t \t\t\t\t\t</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_client_group_id\t \t\t\t\t</p></td>\n<td><p style=\"text-align: center;\">yes</p></td>\n</tr>\n<tr>\n<td><p>iam_client_id\t \t\t\t\t\t</p></td>\n<td><p style=\"text-align: center;\">yes</p></td>\n</tr>\n<tr>\n<td><p>iam_client_secret\t \t\t\t\t</p></td>\n<td><p style=\"text-align: center;\">yes</p></td>\n</tr>\n<tr>\n<td><p>iam_federated_domains\t \t\t\t</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_idp_id</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_module_active</p></td>\n<td><p style=\"text-align: center;\">needs to be '0' during changes</p></td>\n</tr>\n<tr>\n<td><p>iam_panelist_sync</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_post_logout_redirect_url</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_proxy_url</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_redirect_url</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_show_error_as_json</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_sso_modules</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_unique_customer_name</p></td>\n<td><p style=\"text-align: center;\">-</p></td>\n</tr>\n<tr>\n<td><p>iam_user_group_id</p></td>\n<td><p style=\"text-align: center;\">yes</p></td>\n</tr>\n<tr>\n<td><p>iam_well_known_url</p></td>\n<td><p style=\"text-align: center;\">yes</p></td>\n</tr>\n</tbody>\n</table><h2 id=\"header-7\">5. swap iam_reference tables</h2><p>login to installation db with efslogin -moe </p><pre><code class=\"language-text\">RENAME TABLE iam_portal_settings TO backup_iam_portal_settings; \nRENAME TABLE iam_portal_settings_transferred TO iam_portal_settings; \nRENAME TABLE iam_portal_user_reference TO backup_iam_portal_user_reference; \nRENAME TABLE iam_portal_user_reference_transferred TO iam_portal_user_reference; \nRENAME TABLE iam_user_reference TO backup_iam_user_reference; \nRENAME TABLE iam_user_reference_transferred TO iam_user_reference;</code></pre><ac:parameter ac:name=\"panelIcon\">:warning:</ac:parameter><ac:parameter ac:name=\"panelIconId\">atlassian-warning</ac:parameter><ac:parameter ac:name=\"bgColor\">#FF8F73</ac:parameter><ac:rich-text-body><p>this is an important step as all changes done so far are stored within the _transferred tables and wont take place unless you swap them with the live tables</p></ac:rich-text-body><h2 id=\"header-8\">6. re-activate SSO module </h2><pre><code class=\"language-text\">helpersEfsChangeConfig iam_module_active 1</code></pre><p>or in system configuration set ‘iam_module_active’ back to 1</p><h2 id=\"header-9\">7. run final test </h2><p>if a testuser is at hand, try to login in inkognito mode to the installation or contact the customer or tivian support supervisor to ask them run a test, you can verify their successful login by checking the OKTA sys log:</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20717178649618\" alt=\"image-20220503-160634.png\"><p></p>",
    "user_segment_ids": [
        360000084973
    ]
}