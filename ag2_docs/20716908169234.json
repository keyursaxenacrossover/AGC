{
    "id": 20716908169234,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/20716908169234.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20716908169234-JLP-Missing-Signature",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": true,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20714711445138,
    "created_at": "2024-08-12T19:58:37Z",
    "updated_at": "2024-08-12T19:58:58Z",
    "name": "JLP Missing Signature",
    "title": "JLP Missing Signature",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-08-12T19:58:58Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<p><b>Original Confluence URL:</b> <a href=\"https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/1240072205\">https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/1240072205</a> - please cross-check the quality of the ZD article with the Confluence counterpart and remove this line before publishing the ZD article</p>\n\n<h2>Table of Contents</h2>\n<ul class=\"toc\">\n<ul>\n<li><a href=\"#header-1\">Steps:</a></li>\n<ul>\n<li><a href=\"#header-3\">Step 1: Use a JLP Domain to trigger Federation</a></li>\n<ul>\n<li><a href=\"#header-5\">Step 2: Check Auth Request and Auth Response</a></li>\n<li><a href=\"#header-6\">Step 3: Solve Signature Issue</a></li>\n</ul>\n</ul>\n</ul>\n</ul><p>At the moment of writing this JLP was using SAML and the communication with them was in a starting phase.</p><h1 id=\"header-1\">Steps:</h1><ac:parameter ac:name=\"maxLevel\">3</ac:parameter><ac:parameter ac:name=\"minLevel\">3</ac:parameter><h2 id=\"header-3\"><strong>Step 1: Use a JLP Domain to trigger Federation</strong></h2><p>Login at our Tivian Okta Account with an JLP email-address (or something that ends with a domain that is routet to JLP’s Identity Provider)</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716908627858\" alt=\"john_lewis_1.PNG\"><h3 id=\"header-5\"><strong>Step 2: Check Auth Request and Auth Response</strong></h3><p>When login in a “General Error” Page from Okta is shown. This occurs due to an error in the communication with JLP’s Identity provider. When looking at the Auth Request to JLP everything looks fine in the first place.</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716934262418\" alt=\"john_lewis_2.PNG\"><p></p><p><strong>Check the Form Data that is sent:</strong></p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716934191762\" alt=\"john_lewis_3.PNG\"><p><strong>Our Auth Request (decoded):</strong></p><pre><code class=\"language-xml\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;saml2p:AuthnRequest AssertionConsumerServiceURL=\"https://access.questback.com/sso/saml2/0oa237f0jyRG4sZno416\" Destination=\"https://jlp-logon-ppd.johnlewis.co.uk/idp/SSO.saml2\" ForceAuthn=\"false\" ID=\"id26824557734261538952968480\" IssueInstant=\"2020-02-20T08:13:18.941Z\" Version=\"2.0\"\n    xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\"&gt;\n    &lt;saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;https://www.okta.com/saml2/service-provider/sptzmqzmfsnentqkwnvx&lt;/saml2:Issuer&gt;\n    &lt;saml2p:NameIDPolicy Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\"/&gt;\n&lt;/saml2p:AuthnRequest&gt;</code></pre><p></p><p><strong>The error can be seen in JLP’s Auth Response.</strong></p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716934139410\" alt=\"john_lewis_7.PNG\"><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716900515346\" alt=\"john_lewis_5.PNG\"><p></p><p>The important part here is the field <code>&lt;samlp:StatusMessage&gt;Signature required&lt;/samlp:StatusMessage&gt;</code> (see below)</p><p>This field gives the indicator that the Auth Request should have a signature.</p><p><strong>JLP’s Auth Response (decoded):</strong></p><pre><code class=\"language-xml\">&lt;samlp:Response Version=\"2.0\" ID=\"OzgLEiV8a4ZAAGSAu.D3SADEKD.\" IssueInstant=\"2020-02-20T08:13:19.464Z\" InResponseTo=\"id26824557734261538952968480\" Destination=\"https://access.questback.com/sso/saml2/0oa237f0jyRG4sZno416\" \n    xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"&gt;\n    &lt;saml:Issuer xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\"&gt;johnlewis:idp:ppd&lt;/saml:Issuer&gt;\n    &lt;ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n        &lt;ds:SignedInfo&gt;\n            &lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n            &lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/&gt;\n            &lt;ds:Reference URI=\"#OzgLEiV8a4ZAAGSAu.D3SADEKD.\"&gt;\n                &lt;ds:Transforms&gt;\n                    &lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n                    &lt;ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n                &lt;/ds:Transforms&gt;\n                &lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/&gt;\n                &lt;ds:DigestValue&gt;9spKNBscMiZyn+1y35fDjC8OARxw//g4PerOE8hwV/k=&lt;/ds:DigestValue&gt;\n            &lt;/ds:Reference&gt;\n        &lt;/ds:SignedInfo&gt;\n        &lt;ds:SignatureValue&gt;\nWKbDUNSi5SGY0KjEJuP8ka0DQU1xIsI9//xTZr4FePIbem5TYsGNqDtYX/idWj/9WmHBsaV4TIlv Rd3lUp3k3lTC1Di0DGIscpZERdsaP2nhdkK9TiHhyH39jtKXuRXhOUYF8PpEhDsBr4XlG8Ro08/p WY1CTgZeej6JLUQXSIR04mcCzl4UAe6jvyOj/nNQi9ZRjcGoptlRimdwCWxX9y/59htaRWdWfZv+ sZZ6skdq7FeLSLdwic8DNkARvKk+U9PJxT8FGeAXqTWw2+va2nHWucWHlPLCvur5txvkp+MIkw5D YR7tZlCaGSS2acBwlVhHUUFsVA/Ydk6tdzHxZg==\n        &lt;/ds:SignatureValue&gt;\n        &lt;ds:KeyInfo&gt;\n            &lt;ds:X509Data&gt;\n                &lt;ds:X509Certificate&gt;\nMIIFCjCCA/KgAwIBAgITOAAAhJ/i4RODwYBPDwAAAACEnzANBgkqhkiG9w0BAQsFADBkMQswCQYD VQQGEwJHQjEfMB0GA1UEChMWSm9obiBMZXdpcyBQYXJ0bmVyc2hpcDEgMB4GA1UECxMXUGFydG5l cnNoaXAgSVQgU2VydmljZXMxEjAQBgNVBAMTCUpMUFN1YkNBMjAeFw0xOTA2MTExNDU2MDlaFw0y MjA2MTAxNDU2MDlaMD8xCzAJBgNVBAYTAlVLMRMwEQYDVQQKEwpqb2huIGxld2lzMRswGQYDVQQD ExJqbHAtc2lnbi1qb2hubGV3aXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCAjbcf IPXXRM4P+OttbUhRQPv6gKWJ0fo1awy3BYkSmhfNLPUFUuDLIFk2nFfGK88rvsqlFi513NuQT6Es 2OwFQT5F+6V3J6R9BLNAcYUKapvAUXJNwjxhL6QGJH4kWgrjuTHBDpsU+g0nn45QICqD8glgtn26 kRTr4j7TkX5uwOChCJha0aZ0lig6C92FMrAzAVsh3wsuaerjT3FaQ7NiCODzOy8VazEosPwpXMx/ ftSUFfaFzpRPUgQl6vO6YMEeFsywM0P/EBq8C0244kl8ET9/EZQ8/gnjyKOk0n/l5wT3aSMDlmiW pttEJ7icg36k8R2nB5nFsKgf5lMX3VoJAgMBAAGjggHYMIIB1DAdBgNVHQ4EFgQUzYcJos+e3iha ATmZoEQ8IdECVL8wHwYDVR0jBBgwFoAUqK/rqt6pk0Xb8Gjt3VySNLtbkBEwQgYDVR0fBDswOTA3 oDWgM4YxaHR0cDovL3Bwa2ktY3JsLXByZC5qb2hubGV3aXMuY28udWsvSkxQU3ViQ0EyLmNybDCB gwYIKwYBBQUHAQEEdzB1MDQGCCsGAQUFBzABhihodHRwOi8vcHBraS1haWEtcHJkLmpvaG5sZXdp cy5jby51ay9vY3NwMD0GCCsGAQUFBzAChjFodHRwOi8vcHBraS1haWEtcHJkLmpvaG5sZXdpcy5j by51ay9KTFBTdWJDQTIuY3J0MA4GA1UdDwEB/wQEAwIFoDA8BgkrBgEEAYI3FQcELzAtBiUrBgEE AYI3FQibkAGE2ql0g72bAoKusiOGmZwMa4SRxA2Hza8aAgFkAgEdMBMGA1UdJQQMMAoGCCsGAQUF BwMBMBsGCSsGAQQBgjcVCgQOMAwwCgYIKwYBBQUHAwEwSAYDVR0gBEEwPzA9BgwqhjoAAYHP3nJk AQIwLTArBggrBgEFBQcCARYfaHR0cDovL3Bwa2ktY3BzLmpvaG5sZXdpcy5jby51azANBgkqhkiG 9w0BAQsFAAOCAQEANXaCFoGH3HnWUTp0DV2hpX3yHgftDgVs/bKTB7qAWDlIshYY68OXemhBWHPH DZFidi6ynZVr90rnakgrVyOb1WdN85rALuVE1GdJd3WDFkMEUmuw6hGA9Vt3ahA+9HpvFhssCdJw Aa0rQV7Xy/+0v+xuUrQu9FWQFkpG4kRB2KfJhR/a0Ta6Ad1Sxj/h+iA8ISM9LV/lUCTuWq7x1vIC R97K41PHU/VOWs8jd/CRZ3UeFz+pes2YRTe4rCKRwWmSkM9U56ZxB4lDjYbLbgk6JbFs52xrKGEG jPD8zWq0M7xN+iIvbgac4G/o+YI3dtQJk21lQAQ7ML54h6b40XbA0g==\n                &lt;/ds:X509Certificate&gt;\n            &lt;/ds:X509Data&gt;\n        &lt;/ds:KeyInfo&gt;\n    &lt;/ds:Signature&gt;\n    &lt;samlp:Status&gt;\n        &lt;samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Requester\"/&gt;\n        &lt;samlp:StatusMessage&gt;Signature required&lt;/samlp:StatusMessage&gt;\n    &lt;/samlp:Status&gt;\n&lt;/samlp:Response&gt;</code></pre><p></p><h3 id=\"header-6\"><strong>Step 3: Solve Signature Issue</strong></h3><p>This issue can be solved by enabling the Auth Request Signature in Okta. Navigate to the respective Identity Provider and enable “Request Signature” in the advanced settings:</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716923324178\" alt=\"john_lewis_8.PNG\"><p></p>",
    "user_segment_ids": [
        360000084973
    ]
}