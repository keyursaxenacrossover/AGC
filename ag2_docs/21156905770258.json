{
    "id": 21156905770258,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/21156905770258.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21156905770258-Changing-the-Root-Password-in-DXI-Installations-in-Bulk",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": false,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20389541164690,
    "created_at": "2024-09-04T10:40:19Z",
    "updated_at": "2024-12-27T15:42:48Z",
    "name": "Changing the Root Password in DXI Installations in Bulk",
    "title": "Changing the Root Password in DXI Installations in Bulk",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-12-27T15:42:48Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075274,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<h1 id=\"h_01J6Y95ECWWP7SF6W79KA5C860\">Overview</h1>\n<p>It was agreed that instead of having 100+ installs with 100+ different root passwords kept in the legacy Keepass vault, we would be having a singular password for all the root accounts in all installations, that we would rotate from time to time.</p>\n<p>This article details the commands used to change the password via SSH/CLI.</p>\n<h1 id=\"h_01J6Y95GF76FJ2PH5004R06ESW\">Information</h1>\n<p>This procedure will need to be done on all service gateways, so <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21139518716562-How-to-Access-and-Work-with-DXI-Service-Gateways\">How to Access and Work with DXI Service Gateways</a> will be used to connect to each of them and run the below steps on each of them:</p>\n<ol>\n<li>First we need to change the password in a single instance; login to the training instance: <a href=\"https://tx3689.customervoice360.com/www/\">https://tx3689.customervoice360.com/www/</a> </li>\n<li>Click on <strong>User &gt; Edit User Data &gt; Security</strong> and proceed with the password change\n<ol>\n<li><strong>MAKE SURE YOU NOTE DOWN THIS PASSWORD, AS THIS WILL NEED TO GO IN PASSWORDSTATE</strong></li>\n</ol>\n</li>\n<li>Login to the <strong>Sandbox-DE-02</strong> service gateway, where the training instance lives</li>\n<li>Follow the steps for <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21140364670866-How-to-Access-and-Work-with-MariaDB-on-DXI-Service-Gateways\">How to Access and Work with MariaDB on DXI Service Gateways</a>, <strong>steps 1 - 3</strong>\n<ol>\n<li style=\"box-sizing: border-box;\">\n<strong style=\"box-sizing: border-box; font-weight: bolder;\">Source the bashhelper script</strong> to set up the environment. Run the following command:<br><code class=\"!whitespace-pre hljs language-bash\" style=\"box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, ' Liberation Mono' , ' Courier New' , monospace; font-size: inherit; color: inherit; word-break: normal;\"><span class=\"hljs-built_in\" style=\"box-sizing: border-box;\">source</span> /nfs/techsupport/bashhelperstsforaws/EFS_TS_bashhelpers.sh</code>\n</li>\n<li style=\"box-sizing: border-box;\">Run the following command to access the training instance: <code>i tx3689</code>\n</li>\n<li style=\"box-sizing: border-box;\">Run <code>efslogin</code> to login to MariaDB</li>\n</ol>\n</li>\n<li>Once logged into MariaDB, run the following query:<br><code>SELECT uid, u_account, u_passwd from users where uid = 1 and u_account = 'root';</code>\n</li>\n<li>Take note of the value of <code>u_passwd</code>\n</li>\n<li>Navigate to the home folder of your user:<br><code class=\"!whitespace-pre hljs language-bash\" style=\"box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, ' Liberation Mono' , ' Courier New' , monospace; font-size: inherit; color: inherit; word-break: normal;\"><span class=\"hljs-built_in\" style=\"box-sizing: border-box;\">cd ~</span></code>\n</li>\n<li>Run the below command to backup the current password/s (replace date with current date in format <strong>20240904</strong>)\n<pre>clear &amp;&amp; echo \"cluster;technical_name;uid,u_account,u_passwd\" &amp;&amp; for i in $(ls /nfs/installations/);do cd /nfs/installations/$i/nfs/opst/$i.customervoice360.com/htdocs/ 2&gt; /dev/null &amp;&amp; (echo \"SET SQL_BIG_SELECTS=1;SELECT CONCAT_WS(';',uid,u_account,u_passwd) FROM users WHERE uid = 1 AND u_account = 'root';\" | efslogin -mo) 2&gt; /dev/null | awk -v cluster=\"$(hostname | sed 's/servicegw-//g;s/^s/S/g;s/^p/P/g;s/bofa/BofA/g;s/-de-/-DE-/g;s/-us-/-US-/g')\" -v inst=\"$i\" 'NR&gt;3{OFS=\";\"; print cluster, inst, $0 | \"sort -n | uniq\"}';done &gt; /nfs/dumps/password_dump_$(<span class=\"hljs-built_in\">date</span> +<span class=\"hljs-string\">'%Y-%m-%d'</span>).txt</pre>\n</li>\n<li>Now it's time to update the password in all installations residing in that service gateway (replace <strong>password_hash</strong> with the actual hash obtained in <strong>step 6</strong>)\n<pre>for i in $(ls /nfs/installations/);do cd /nfs/installations/$i/nfs/opst/$i.customervoice360.com/htdocs/ 2&gt; /dev/null &amp;&amp; (echo 'UPDATE users SET u_passwd = \"password_hash\" WHERE uid = 1 AND u_account = \"root\";SELECT uid,u_passwd,u_account,u_email FROM users WHERE uid = 1;' | efslogin -mo) 2&gt; /dev/null;done</pre>\n</li>\n<li>Once done, verify that the password works on one of the installations in the cluster.</li>\n<li>Move on to the next cluster. <br><em><strong>**Additional steps for de-03 cluster<br></strong></em>- We will need to revert the password change for 2 PAYBACK installations by following the steps below:\n<pre>i np3104<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$evEJ76eMFYfjlNyw$IWG9s0.AxmNF1VXJI1035liMumckMLYnz6bRsfE7NtH1XainDFVUCfJGsy40VQtZyPKgt0Kc2tw9uUn6IaK3V0' WHERE uid = 1 AND u_account = 'root';</pre>\n<pre>i fg4086<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$evEJ76eMFYfjlNyw$IWG9s0.AxmNF1VXJI1035liMumckMLYnz6bRsfE7NtH1XainDFVUCfJGsy40VQtZyPKgt0Kc2tw9uUn6IaK3V0' WHERE uid = 1 AND u_account = 'root';</pre>\n- We will need to revert the password change for BMW installations by following the steps below:\n<pre>i eq5701<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$CTj3BL5mUn0EL4eL$e2uNYO6PXRoE042hhRmL2N5RhPb0aJqF/F5Z0/PwjbF/K2FSbaG8SI83fAsQAbw5JUpylRJ4V2rG7jjuCwQSb0' WHERE uid = 1 AND u_account = 'root';</pre>\n <br>- We will need to revert the password change for 3 Unipark installations by following the steps below:\n<pre>i kw0791<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$1Evfcr6U6RhhDp48$8S1Kt7AKR.bKrcqlaYvVJj1WF3V4fBstZIy11mvp5GZ6bMunoFmCOmG98rYvTtClixDbO.fYg/X68MgWLfBmY/' WHERE uid = 1 AND u_account = 'root';</pre>\n<pre>i df1582<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$1Evfcr6U6RhhDp48$8S1Kt7AKR.bKrcqlaYvVJj1WF3V4fBstZIy11mvp5GZ6bMunoFmCOmG98rYvTtClixDbO.fYg/X68MgWLfBmY/' WHERE uid = 1 AND u_account = 'root';</pre>\n<pre>i sr4501<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$1Evfcr6U6RhhDp48$8S1Kt7AKR.bKrcqlaYvVJj1WF3V4fBstZIy11mvp5GZ6bMunoFmCOmG98rYvTtClixDbO.fYg/X68MgWLfBmY/' WHERE uid = 1 AND u_account = 'root';</pre>\n<em><strong>**Additional steps for sandbox cluster<br></strong></em>We will need to revert the password change for BMW installations by following the steps below:\n<pre>i eq5701<br>efslogin<br>UPDATE users SET u_passwd = '$6$rounds=5000$CTj3BL5mUn0EL4eL$e2uNYO6PXRoE042hhRmL2N5RhPb0aJqF/F5</pre>\n</li>\n<li>Update PasswordState with the new password obtained in <strong>step 2.1</strong> (the <strong>DXI/EFS common root user</strong> entry)\n<ol>\n<li>If you don't have the required rights to do this, ping Ciprian, Rishi or Raymond.</li>\n</ol>\n</li>\n</ol>",
    "user_segment_ids": [
        360000084973
    ]
}