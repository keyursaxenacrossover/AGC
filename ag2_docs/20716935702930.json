{
    "id": 20716935702930,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/20716935702930.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20716935702930-Intervista",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": true,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20714711445138,
    "created_at": "2024-08-12T19:59:53Z",
    "updated_at": "2024-08-12T20:00:04Z",
    "name": "Intervista",
    "title": "Intervista",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-08-12T20:00:04Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<p><b>Original Confluence URL:</b> <a href=\"https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/1293680664\">https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/1293680664</a> - please cross-check the quality of the ZD article with the Confluence counterpart and remove this line before publishing the ZD article</p>\n\n<h2>Table of Contents</h2>\n<ul class=\"toc\">\n<ul>\n<li><a href=\"#header-1\">What happened?</a></li>\n<ul>\n<li><a href=\"#header-3\">The V2.0 flow</a></li>\n<li><a href=\"#header-4\">The V1.0 flow</a></li>\n<li><a href=\"#header-5\">Result:</a></li>\n</ul>\n</ul>\n</ul><p></p><h1 id=\"header-1\">What happened?</h1><p>Intervista is using an Azure AD that should be federated via OpenID Connect with Okta.</p><p></p><p>Simply setting that up did not work. When trying to login we just got an error screen.</p><p>After checking the logs in Okta we could see that Okta was complaining about a missing username.</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716951782930\" alt=\"debugging_case_intervista_1.PNG\"><p></p><h2 id=\"header-3\">The V2.0 flow</h2><p>Thus we tried to get the token Okta will retrieve manually. We created a Sign-In link to the external Azure AD manually. After logging in with our test-user at the external Azure AD Okta did not exchange the OIDC code of the response for a token. We used postman to get that token with the responded code.</p><p>We used a link like to login to the external Azure AD:</p><p><a href=\"https://login.microsoftonline.com/ce28fcc1-a19e-477b-8194-0b272d1e6bb2/oauth2/v2.0/authorize?state=cTN1UzRUM05WYWlqVEh1SmpGS2hSZ09uL2VxTlJCUEcyZzJFdTZTTlNPQ0QrSG9aY0dmTlcwK0t5Qk1XVU1WaQ&amp;client_id=735b77b3-0297-4d2e-9de5-a98591aa4dd8&amp;redirect_uri=https%3A%2F%2Faccess.questback.com%2Foauth2%2Fv1%2Fauthorize%2Fcallback&amp;response_type=code&amp;scope=email+openid+profile&amp;sso_reload=true#\">https://login.microsoftonline.com/ce28fcc1-a19e-477b-8194-0b272d1e6bb2/oauth2/v2.0/authorize?state=cTN1UzRUM05WYWlqVEh1SmpGS2hSZ09uL2VxTlJCUEcyZzJFdTZTTlNPQ0QrSG9aY0dmTlcwK0t5Qk1XVU1WaQ&amp;client_id=735b77b3-0297-4d2e-9de5-a98591aa4dd8&amp;redirect_uri=https%3A%2F%2Faccess.questback.com%2Foauth2%2Fv1%2Fauthorize%2Fcallback&amp;response_type=code&amp;scope=email+openid+profile&amp;sso_reload=true#</a></p><p>We got the following response with the code in the URL we used to get the tokens:</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716951647762\" alt=\"debugging_case_intervista_2.PNG\"><p></p><p>In the response we saw that the neither the userinfo endpoint nor the Identity Token had enough information to get first name, last name and email of the user.</p><p>(Our own Azure AD at least has enough information in the userinfo endpoint)</p><p><ac:parameter ac:name=\"title\">Screenshots missing</ac:parameter><ac:parameter ac:name=\"colour\">Red</ac:parameter> </p><p></p><h2 id=\"header-4\">The V1.0 flow</h2><p>After that we saw that we are using the v2.0 endpoints of the Azure AD. We then tried to do the same with the v1.0 endpoints of the Azure AD.</p><p>We used the steps above until getting the code for a token.</p><p>We used the following postman request to get the tokens.</p><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716935850258\" alt=\"debugging_case_intervista_3.PNG\"><p>And got the following response as result (yes the tokens are cut):</p><pre><code class=\"language-json\">{\n    \"token_type\": \"Bearer\",\n    \"expires_in\": \"3599\",\n    \"ext_expires_in\": \"3599\",\n    \"expires_on\": \"1583932197\",\n    \"access_token\": \"jHRsluyAcxHFz1ZHS9kJSE-6NVz61g74bemmIJo2FcTWV5P3Yn2hg2nEJW3eATAqSu_kIiNI3xwWZSeq4AAFlJYmoWF2zwdp7mLKySG-Qs0OKR0pKyO4_uoU2I1SxjKc9zJIAYbYDHYSRjgFl3BHI5XSAi-5z3MQ51Mj_JKwFor-RzewFbn4uwr3m41fdPRTUW2c7yEAlRBmyegCz7IZHEW3MCZr_QYm7ddMGE4kKRuuTHSkSP1PTG7S3_FI0X8aJE3iJgdMYutG5t7EG2Kl3Q3BcNU1k3h2vu-x1h3Az8DLWuWtK1cJ8T3uASSZFh86O0733_vDH-UTfdWSh_6-K7GnAwFcdEqMacM0AcS5ksu7XewipWNnZe-UpzQd9JW-DK_GHe1UQFCRmoPkbS8ehiZtConV8aePJ4SceoPbgSyqnKfPt7oBoyxkjLXJ8hjoI_6_cWYm8RSA8udrNwY13aSR7m3v84oPkoGXyVfHv8u_9HnPF3icg6Vvtgvrsbw7DR1nPH4aE7BFlgcEcQ4OCXoF7QwVDN2dULFFp09wGka3o_orUeu_f7r-fZVaLER0wWJbtjvyswWez_jTtewyUgAA\",\n    \"refresh_token\": \"cj7L8hZ8gZ1w1s7ZCu_PvvBjJTLGbYgF9uNRDd41Ho9tub92v3X54ft_myyEX-LyfuB5FZtILM_eCC9EesNhN8PbYVpUKARnis57nzZvU_BvYekdoPSWd-wBu8HlV_YAFLChCDcPOyu4YGcqYJS4dJRsZkkmMen3vrWLRzdSzzaRQdDCQu89oqSbelPd2dHVLDshe7Xk4TrVYiW41OMRm6O1rDeGEZr632I0jJtS_Bd1K4PeSI06_M1YbTzv2obUOtUJBknbIgwpDRc4aQM5Ko2PUqqBT7ICcyyiaj0yCxb43zM-_Y3jvjpbr1WuevjUkjGbJD19fzVpCKe_ALl5NWrQypPyaAv-VZ9pmBwEDwRirWlv1g6e4Yk6V8dRDNRi9f5Ux4Mzv6LcnyXiAnNYBD1dB_UgOBeDeT6HvMIQJhBTod61PXt47GVr5sTR9ab1_rFYC4WQUgWw_CveKjrFOHuvojQkHa0DKnCc30YS_hY8hpUXahpFceWiY_rqh12ZfQKWVxzxbpksl_fmCBzJpUuwIUaK7L5cGBm6Bbsqd0tGP2h_zX5P59gx5NnAsgrKYHzEyMvUd48hVTyXvRd0WuTkZYP0eE_GSb2q6dh5rt84t44h0AhYkqPuMR5qvhqFiSCUcMsxZJTtXDqoabROJdC6EgpuAXNkymTc_JpIYoSrkqI5n7vq8R82HSVtmiOIrHV0rBViQGHH49-uV38OqhIrE53nOC4IAA\",\n    \"id_token\": \"CI6IkhsQzBSMTJza3hOWjFXUXdtak9GXzZ0X3RERSJ9.eyJhdWQiOiI3MzViNzdiMy0wMjk3LTRkMmUtOWRlNS1hOTg1OTFhYTRkZDgiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9jZTI4ZmNjMS1hMTllLTQ3N2ItODE5NC0wYjI3MmQxZTZiYjIvIiwiaWF0IjoxNTgzOTI4Mjk3LCJuYmYiOjE1ODM5MjgyOTcsImV4cCI6MTU4MzkzMjE5NywiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IldldHRlIiwiZ2l2ZW5fbmFtZSI6Ik1pY2hhZWwiLCJpcGFkZHIiOiIzNy4yMDEuMTk0LjIyMiIsIm5hbWUiOiJNaWNoYWVsIFdldHRlIiwib2lkIjoiMjY1NjRiZDAtYjA4Ni00NWRhLTk5YmMtMGJkNzQ1MzVhNGM2Iiwic3ViIjoiU2F3Nm55emMtSG1ZVUFfaTNidjlXck1XaVN0LUhuSEoxSWJsTGtMYmhyQSIsInRpZCI6ImNlMjhmY2MxLWExOWUtNDc3Yi04MTk0LTBiMjcyZDFlNmJiMiIsInVuaXF1ZV9uYW1lIjoicWJ0ZXN0QGludGVydmlzdGEuY2giLCJ1cG4iOiJxYnRlc3RAaW50ZXJ2aXN0YS5jaCIsInV0aSI6IkpmclBhQzNEU2ttaHhiU3BHcHdwQUEiLCJ2ZXIiOiIxLjAifQ.scyTuT086J-NyX8J-7I5BklYCaj2eV_csQ52CIlHn5BOHieiLgpVOFpDZPQBFzNaLNW04T3TQxXPnL4pSMuyckgZYaRwLM6dwUUB1rE5RBdPpycV1Hhe1CBE7Z0W4GcZl1cw9WTneMlB4jni2XnlvsAwvAzDylvJpZ9c66jFgdCcvhJYfyWPv9_8v_9whjwOyTR8aXXNESDGRO0fvgUFnHDidV0ijfHGK4xaxTAOUSkGEKNqtXv0MTfIWL90GqLNm6NsTd-wpB0m2IGj82a2cgJIuLBtbzBTn6EdK8bopUSMBSCA9TrY3g6YzI5fWO_cP9BuxCNRcooNs0_ihUgdkw\"\n}</code></pre><p></p><p>The parsed ID Token looked like the following:</p><pre><code class=\"language-json\">{\n  \"aud\": \"735b77b3-0297-4d2e-9de5-a98591aa4dd8\",\n  \"iss\": \"https://sts.windows.net/ce28fcc1-a19e-477b-8194-0b272d1e6bb2/\",\n  \"iat\": 1583928297,\n  \"nbf\": 1583928297,\n  \"exp\": 1583932197,\n  \"amr\": [\n    \"pwd\"\n  ],\n  \"family_name\": \"Wette\",\n  \"given_name\": \"Michael\",\n  \"ipaddr\": \"37.201.194.222\",\n  \"name\": \"Michael Wette\",\n  \"oid\": \"26564bd0-b086-45da-99bc-0bd74535a4c6\",\n  \"sub\": \"Saw6nyzc-HmYUA_i3bv9WrMWiSt-HnHJ1IblLkLbhrA\",\n  \"tid\": \"ce28fcc1-a19e-477b-8194-0b272d1e6bb2\",\n  \"unique_name\": \"qbtest@intervista.ch\",\n  \"upn\": \"qbtest@intervista.ch\",\n  \"uti\": \"JfrPaC3DSkmhxbSpGpwpAA\",\n  \"ver\": \"1.0\"\n}</code></pre><p></p><p>Here we can see that email (upn), first name (family_name) and last name (given_name) at least exist. So they can be used.</p><p></p><h2 id=\"header-5\">Result:</h2><p>A client has to adapt the endpoints so that they give information about first name, last name and email. This information has to be part of the ID Token or at least the userinfo endpoint (in that case the userinfo endpoint has to be configured).</p><p></p><p></p>",
    "user_segment_ids": [
        360000084973
    ]
}