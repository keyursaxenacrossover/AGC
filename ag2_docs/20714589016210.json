{
    "id": 20714589016210,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/20714589016210.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/20714589016210-Nightly-Upgrade-Nightly-Update-Skript",
    "author_id": 369584192734,
    "comments_disabled": false,
    "draft": true,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20714530860562,
    "created_at": "2024-08-12T16:47:48Z",
    "updated_at": "2024-08-12T16:47:50Z",
    "name": "Nightly Upgrade/Nightly Update Skript",
    "title": "Nightly Upgrade/Nightly Update Skript",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-08-12T16:47:50Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [],
    "body": "<p><b>Original Confluence URL:</b> <a href=\"https://qbdocs.atlassian.net/wiki/spaces/TS/pages/1053622430\">https://qbdocs.atlassian.net/wiki/spaces/TS/pages/1053622430</a> - please cross-check the quality of the ZD article with the Confluence counterpart and remove this line before publishing the ZD article</p>\n\n<h2>Table of Contents</h2>\n<ul class=\"toc\">\n<ul>\n<li><a href=\"#header-1\">What´s the purpose of this script?</a></li>\n<ul>\n<li><a href=\"#header-3\">Where are the files?</a></li>\n<ul>\n<li><a href=\"#header-5\">Detailed description and contents of the file:</a></li>\n<li><a href=\"#header-6\">How do I prepare it?</a></li>\n<li><a href=\"#header-7\">How do i execute the Nightly script manually?</a></li>\n<ul>\n<li><a href=\"#header-9\">Cronjob</a></li>\n</ul>\n</ul>\n</ul>\n</ul>\n</ul><h1 id=\"header-1\">What´s the purpose of this script?</h1><p>The Nightly Upgrade/Update script is used if several installations (in Bremen) have to be update/upgrade in one go.</p><p></p><h2 id=\"header-3\">Where are the files?</h2><p>The files are here (in Frankfurt) /opt/pdp/support/nightlyUpgradeSkript: </p><ul>\n<li><p>Installation.txt.Muster: Template file hat needs to be copied to prepare a new nightly update/upgrade.</p></li>\n<li><p>Installation.txt: File that holds the paths of all installation that shall be updated/upgraded. <ac:inline-comment-marker ac:ref=\"4fc5b6ab-c532-43fa-8682-bca3740ab3c3\">Structure see example. </ac:inline-comment-marker>Must be located under /dumps/nightlyUpgrade.</p></li>\n<li><p>precheck.sh: Script that checks the Installation.txt for the correct format and checks whether the installations are in the ROM and can be updated/upgraded</p></li>\n<li><p>nightlyUpgradeScript.sh: Script that executes the actual update/upgrade of all installations listed in the Installation.txt.</p></li>\n</ul><p></p><div class=\"expand-macro\">\n<h4 string=\"Installation.txt Example structure \"></h4>\n<p>Installations path;rolloutConfig;MainBuild or Testbuild;EFS Version; Build Number;Update only(false/true);Update information<br>/nfs/opst11/skopos1.de;../etc/rollout2.conf;TEST;EFS_10.8;0003_1;true;Update regarding Reporting+ fixes<br>/nfs/opst12/ww2.umfragecenter.de;../etc/rollout2.conf;TEST;EFS_10.8;0003_1;true;Update regarding Reporting+ fixes</p>\n</div><ul><li>\n<p>System Administration</p>\n<ul><li><p>soft deletes installation and everything related to it (i.e. makes it unavailable first before deleting it ultimately)</p></li></ul>\n</li></ul><h3 id=\"header-5\">Detailed description and contents of the file:</h3><ul>\n<li>\n<p>Installation path</p>\n<ul><li><p>Please only use base path of installation, do not include htdocs folder, e.g.: /nfs/opst17/qz7703.customervoice360.com</p></li></ul>\n</li>\n<li>\n<p>rolloutConfig</p>\n<ul>\n<li><p>Config file created by System Administration, can be found here: /opt/pdp/rollout2/etc/rollout2.conf</p></li>\n<li><p>Use relative path only: ../etc/rollout2.conf</p></li>\n</ul>\n</li>\n<li>\n<p>MainBuild or TestBuild</p>\n<ul><li><p>Available values: TEST oder MB</p></li></ul>\n</li>\n<li>\n<p>EFS Version</p>\n<ul><li><p>Always use the branch, e.g. EFS_10.7,EFS_10.8</p></li></ul>\n</li>\n<li>\n<p>Build number</p>\n<ul>\n<li><p>Test build, example: 0001_1, 0002_1 or 0003_1</p></li>\n<li><p>Main build e.g. 0003</p></li>\n</ul>\n</li>\n<li>\n<p>Update only(false/true)</p>\n<ul>\n<li><p>false = an upgrade is done</p></li>\n<li><p>true = an update is done</p></li>\n</ul>\n</li>\n<li>\n<p>Update information</p>\n<ul><li><p>Only needs to be filled if \"Update only\" is true i.e. in case we only do an update</p></li></ul>\n</li>\n</ul><h3 id=\"header-6\">How do I prepare it?</h3><ul>\n<li>\n<p>In Globis:</p>\n<ul>\n<li>\n<p>Select all installations that need to be updated/upgraded:</p>\n<ul>\n<li><p>Rolloutmanagement=1</p></li>\n<li><p>Version= e.g. 10.8</p></li>\n<li><p>you can make further restrictions, e.g. Data Centre=Bremen</p></li>\n</ul>\n</li>\n<li><p>Export the data using <strong>Result export (CVS)</strong></p></li>\n</ul>\n</li>\n<li>\n<p>In Excel:</p>\n<ul>\n<li><p>In case of an update: In column <strong>EFS tag</strong> check whether there are installations that already have this version. Remove these installations from the list.</p></li>\n<li><p>Copy <strong>Installation path</strong> of remaining installations.</p></li>\n</ul>\n</li>\n<li>\n<p>In the console:</p>\n<ul>\n<li><p>Navigate to <strong>/dumps/nightlyUpgrade/</strong>.</p></li>\n<li>\n<p>Copy <strong>Installation.txt.Muster</strong>:</p>\n<ul><li><pre><code class=\"language-text\">cp Installation.txt.Muster Installation.txt</code></pre></li></ul>\n</li>\n<li>\n<p>Edit copy:</p>\n<ul><li><pre><code class=\"language-text\">vi Installation.txt</code></pre></li></ul>\n</li>\n<li><p>Insert the list of installations from previous excel file.</p></li>\n<li>\n<p>Replace <strong>/htdocs/conf/..</strong> with <strong>../etc/rollout2.conf</strong> and fill out remaining fields:</p>\n<ul><li>\n<p>Example:</p>\n<pre><code class=\"language-text\">:%s!/htdocs/conf/../!;../etc/rollout2.conf;TEST;EFS_10.8;0003_1;true;Update regarding Reporting+ fixes!g</code></pre>\n</li></ul>\n</li>\n<li><p>Save the file.</p></li>\n<li>\n<p>Execute <strong>precheck.sh</strong> to check the format of Installation.txt and to check the installations:</p>\n<ul><li><pre><code class=\"language-text\">sh precheck.sh</code></pre></li></ul>\n</li>\n</ul>\n</li>\n</ul><h3 id=\"header-7\">How do i execute the Nightly script manually?</h3><p>The nightly script is ececuted automatically Monday through Thursday at 2:00am German time (by a cron job).<br>In case you have to execute the script manually, e.g. for US installations you can do so as follows: </p><p></p><ul>\n<li><p>Make sure that all preparations have been done <a href=\"https://it.globalpark.de/twiki/bin/view/Support/TsNightlySkript#How_do_I_prepare_it\">How do I prepare it?</a> and that the <strong>precheck</strong> was successful!</p></li>\n<li>\n<p>Only after that execute the update/upgrade in a 'screen'.</p>\n<ul>\n<li><p>Start screen: screen -S \"[any description of the screen]\"</p></li>\n<li>\n<p>Execute nightly script in screen:</p>\n<ul>\n<li>\n<p>Frankfurt:</p>\n<pre><code class=\"language-text\">/bin/bash /opt/pdp/support/nightlyUpgradeSkript/nightlyUpgradeScript.sh</code></pre>\n</li>\n<li>\n<p><del>Rackspace:</del></p>\n<pre><code class=\"language-text\">/bin/bash /dumps/visser/mercurials/applications/nightlyUpgradeSkript/nightlyUpgradeScript.sh\n Wenn mann anstatt dem kompletten Pfad den vorhandenen Symlink benutzt, wird support/portal_compile_css.php nicht ausgefürt. Man muss dann nachträglich prüfen, ob Portals aktiviert ist und dann aus htdocs/www heraus das Skript per php support/portal_compile_css.php ausführen.</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul><h4 id=\"header-9\">Cronjob</h4><p>The nightly script is executed automatically via a cron job </p><p></p><ul>\n<li>\n<p>The cron can be found here:</p>\n<ul><li><p>/etc/cron.d/rom_nightly</p></li></ul>\n</li>\n<li>\n<p>Contents:</p>\n<pre><code class=\"language-text\"># mm4mathias: daily cron for nightly upgrade\n0 2     * * 1,2,3,4     nfsnobody /bin/bash /opt/pdp/support/nightlyUpgradeSkript/nightlyUpgradeScript.sh\n</code></pre>\n</li>\n</ul>",
    "user_segment_ids": [
        360000084973
    ]
}