{
    "id": 21139650545298,
    "url": "https://discoverxi-supportdesk.zendesk.com/api/v2/help_center/en-us/articles/21139650545298.json",
    "html_url": "https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21139650545298-Generating-a-new-DKIM-Key-for-a-given-domain",
    "author_id": 1904316023094,
    "comments_disabled": false,
    "draft": false,
    "promoted": false,
    "position": 0,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 20234757130258,
    "created_at": "2024-09-03T14:37:05Z",
    "updated_at": "2024-10-07T16:11:50Z",
    "name": "Generating a new DKIM Key for a given domain",
    "title": "Generating a new DKIM Key for a given domain",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-10-07T16:11:50Z",
    "user_segment_id": 360000084973,
    "permission_group_id": 1075294,
    "content_tag_ids": [],
    "label_names": [
        "DKIM",
        "DNS",
        "Support",
        "Email Encryption"
    ],
    "body": "<h1 id=\"h_01J6W53E68E9745H6Q66RJW5X9\">Overview</h1>\n<p>A customer requested a DomainKeys Identified Mail (DKIM) key for a given domain managed by their client. The DKIM key is to be used on a specific installation for the client, with all messages sent from this installation to be DKIM encrypted. This article provides a solution to this request.</p>\n<p> </p>\n<h1 id=\"h_01J6W53E687BTR8HR31YQSP84M\">Scope</h1>\n<div>The DKIM key is generated by the mail server posting the emails.</div>\n<div>For some customers in DXI, mails are created and posted through Hurricane MTA, thus the DKIM should be generated by DXI team and saved in Hurricane, while for other customers, mails are forwarded (relayed) to a customer email server, in that case, DKIM should not be generated by DXI team, but from the customer's mail server (out of scope). </div>\n<div> </div>\n<div>To confirm if the installation is using our mail server, not a customer email server, apply the following steps:</div>\n<ul>\n<li>Through Command line in Service Gateway:<br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/21142676614802\">\n</li>\n<li>Or through GUI:\n<ul>\n<li>Load the instance admin URL using root user</li>\n<li>System -&gt; options -&gt; Platform cockpit -&gt; System Configuration</li>\n<li>Search for \"Mail\"</li>\n<li>Check the mail server values, these should include a postfix address, not an internal IP address.<img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/21142777793426\">\n</li>\n</ul>\n</li>\n<li>If an internal IP is found (ex: 10.250.xx.xx), we do not add DKIM signing as this always should be done on the mail server which responsible for dispatching the mails...</li>\n<li>Additional Info (Just FYI, not needed to complete the request):\n<ul>\n<li>Usually the Hurricane account used to dispatch emails is appended after the text \"postfix\". </li>\n<li>By default all installations send out via the following accounts\n<ul>\n<li>EFS-Production (1006)</li>\n<li>EFS-Adhoc (1007)</li>\n</ul>\n</li>\n<li>This is a naming convention (not a definitive logic), but this should not affect the steps explained below, since the steps apply the new DKIM to all possible sender accounts, even if not used by this installation.</li>\n</ul>\n</li>\n</ul>\n<p>Additional Scoping:</p>\n<ul>\n<li>The <strong>BofA-US-01</strong> cluster does not use Hurricane MTA at all. It is special and uses AWS mailing service as one of their explicit requirements. The whole process setting up a new sender address in the AWS (including DKIM and SPF) never had been passed to L2. Please forward this to SaaS.<br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/21835357724434\">\n</li>\n</ul>\n<h1 id=\"01J6WBQR42Q6CRJESXKSRDM7B9\">Solution</h1>\n<p>To set up DKIM (Domain Keys Identified Mail) for a domain managed by the client, follow these steps:</p>\n<ol>\n<li>\n<strong>Generate DKIM Keys:</strong> There is a ready Docker image containing OpenSSL to generate DKIM keys. You need first to install <a href=\"https://docs.docker.com/engine/install/\">docker</a> on your machine if not already installed. After that, steps are based on Linux/WSL terminal.\n<ol>\n<li>Pull Docker image: <code>docker pull tivian/docker-openssl</code>\n</li>\n<li> Start Docker image in a Linux/WSL terminal: <br><code>docker run -it --rm -v $(pwd):/openssl-certs tivian/docker-openssl:latest</code>s</li>\n<li>In the docker, Create the folder : <code style=\"padding: 0px; font-family: SFMono-Regular, Consolas, ' Liberation Mono' , Menlo, Courier, monospace; font-size: 12px; color: #2f3941; border-radius: 4px; background: #ffffff; border: 1px solid #d8dcde; margin: 0px; outline: 0px; vertical-align: baseline; box-sizing: border-box; line-height: inherit; white-space: pre-wrap; margin-block: 0px; margin-inline: 2px; padding-block: 0px; padding-inline: 5px;\">/openssl-certs/certs/dkimkeys</code> if not already created.</li>\n<li>Execute script using the domain provided:\n<ul>\n<li>Usage:  <code>/usr/local/bin/generate_dkim_keys.sh &lt;domain.tld&gt; tivian</code>\n</li>\n<li>Example: <code>/usr/local/bin/generate_dkim_keys.sh <strong>ifo.de</strong> tivian</code>\n</li>\n</ul>\n</li>\n<li>Copy both Private and public keys:\n<ul>\n<li>Private key sample (copy starting the --- and till the --- at the end of the key):<br><img src=\"https://central-supportdesk.zendesk.com/attachments/token/fLGyzSeEEhbqnfdjlfwwStE5z/?name=image.png\">\n</li>\n<li>Public DNS TXT record sample (to be shared with the customer):<br>\n<pre style=\"padding: 8px; font-family: SFMono-Regular, Consolas, ' Liberation Mono' , Menlo, Courier, monospace; font-size: 12.025px; color: #2f3941; border-radius: 4px; display: block; margin: 0px; line-height: inherit; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background: #ffffff; border: 1px solid #d8dcde; outline: 0px; vertical-align: baseline; box-sizing: border-box; margin-block: 4px 12px; margin-inline: 0px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\"><code style=\"font-family: SFMono-Regular, Consolas, ' Liberation Mono' , Menlo, Courier, monospace; font-size: 12px; color: #2f3941; border-radius: 0px; background: #ffffff; border: 0px; outline: 0px; vertical-align: baseline; box-sizing: border-box; line-height: inherit; white-space: pre-wrap; margin-block: 0px; margin-inline: 2px; padding-block: 0px; padding-inline: 5px; margin: 0px; padding: 0px;\">tivian._domainkey.ifo.de IN TXT \"v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjJgUknIRLfdhjMbvDXxeUh6MQX1ItHXF0OtP557zdWwOQpeNSbRdBVhfmf4WkIVocoelewz+YWtuOeeH7ximR4Mtsuu6ik9vTjoJEl421i9wnkweQHT8zBkSfsPm+6mAldh0ZMMKcyjUf1uM0W2/bt/taszGv3dlFUFHhsJF+yoWBj/YWf1MCfeuM+bo/uw+O2qvAwUEE412+rl0+Y9OyN9kZCiXUC/7anx8tdoKJBWHyww45eAFqBIUCezh56r3YD5XNT3FICTUTkdqZh4EQDRTfqj3hvGN+5j4qY/2GDXHgAJpInSwLWUTgdDZKbMrfMwIWD6e5Hpgfm0xUq08iQIDAQAB\"</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<strong>Add the private key to Hurricane</strong>:<br>Hurricane is a service for sending emails, accessible through a GUI through an internal network. <br><br>Steps to add the key:<br>\n<ol>\n<li>Login to Hurricane MTA (see KeePass for login credentials): <a href=\"https://discoverxi-supportdesk.zendesk.com/hc/en-us/articles/21139518716562-How-to-Access-and-Work-with-DXI-Service-Gateways#01J8QS4CEBNQQ6KPMT655G7Y13\">How to Access Hurricane</a> </li>\n<li>Edit the \"EFS-Production (1006)\" account<br><img src=\"https://central-supportdesk.zendesk.com/attachments/token/sTkhiyU8UpUr8UWhxYNXCUCUH/?name=image.png\">\n</li>\n<li>Select \"DomainKeys / DKIM Options\" from the top menu<br><img src=\"https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/21141926292626\">\n</li>\n<li>Double check the domain to add <strong>if not already there</strong> (using paging links, domains are sorted alphabetically)</li>\n<li>Create \"New...\" DKIM entry</li>\n<li>Add DKIM key:\n<ul>\n<li>Enabled: Yes</li>\n<li>Domain: &lt;domain&gt;</li>\n<li>Selector: tivian</li>\n<li>Method: DomainKeys/DKIM</li>\n<li>Private Key: Copy private key generated in step 1.6</li>\n<li>Notes: Ticket: ZD 4xxxxxx</li>\n</ul>\n</li>\n<li>Repeat the same steps for following accounts: <br>EFS-Adhoc (1007) <br>EFS-Spam (1020) <br>EFS-Pending-Confirmartion (1047)</li>\n</ol>\n</li>\n<li>\n<strong>Validate DNS records quality for the customer domain:</strong>\n<ul>\n<li>Although not the main scope of the request, legacy team used to validate DNS records for the customer domain and share the validation result. This step is not mandatory</li>\n<li>Open following mail testing service: <a href=\"https://www.mail-tester.com/?lang=en\">https://www.mail-tester.com/?lang=en</a>\n</li>\n<li>Copy the address to be used as test recipient</li>\n<li>Open the helper survey : <a href=\"https://tx3689.customervoice360.com/uc/spf-dkim-tester/\">https://tx3689.customervoice360.com/uc/spf-dkim-tester/</a>\n<ol>\n<li> Sender email address: <a href=\"mailto:noreply@&lt;domain&gt;\">noreply@&lt;domain&gt; </a>; example: noreply@ifo.de.</li>\n<li>Recipient: copy email address provided by Mail Tester</li>\n<li>Send page via \"CONTINUE\" button and refresh Mail Tester and unfold all non-green points and create a screenshot of the whole page</li>\n</ol>\n</li>\n<li>Address all issues like in the template found here: <a href=\"https://central-supportdesk.zendesk.com/agent/tickets/4457922\">4457922</a> </li>\n</ul>\n</li>\n<li>\n<strong>Get back to customer</strong> indicating the task is completed, and sharing both the <strong>public DKIM record</strong> and optionally the mail test report.<br>Public DNS TXT record <strong>sample</strong> (to be shared with the customer):<br>\n<pre style=\"padding: 8px; font-family: SFMono-Regular, Consolas, ' Liberation Mono' , Menlo, Courier, monospace; font-size: 12.025px; color: #2f3941; border-radius: 4px; display: block; margin: 0px; line-height: inherit; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background: #ffffff; border: 1px solid #d8dcde; outline: 0px; vertical-align: baseline; box-sizing: border-box; margin-block: 4px 12px; margin-inline: 0px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\"><code style=\"font-family: SFMono-Regular, Consolas, ' Liberation Mono' , Menlo, Courier, monospace; font-size: 12px; color: #2f3941; border-radius: 0px; background: #ffffff; border: 0px; outline: 0px; vertical-align: baseline; box-sizing: border-box; line-height: inherit; white-space: pre-wrap; margin-block: 0px; margin-inline: 2px; padding-block: 0px; padding-inline: 5px; margin: 0px; padding: 0px;\">tivian._domainkey.ifo.de IN TXT \"v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjJgUknIRLfdhjMbvDXxeUh6MQX1ItHXF0OtP557zdWwOQpeNSbRdBVhfmf4WkIVocoelewz+YWtuOeeH7ximR4Mtsuu6ik9vTjoJEl421i9wnkweQHT8zBkSfsPm+6mAldh0ZMMKcyjUf1uM0W2/bt/taszGv3dlFUFHhsJF+yoWBj/YWf1MCfeuM+bo/uw+O2qvAwUEE412+rl0+Y9OyN9kZCiXUC/7anx8tdoKJBWHyww45eAFqBIUCezh56r3YD5XNT3FICTUTkdqZh4EQDRTfqj3hvGN+5j4qY/2GDXHgAJpInSwLWUTgdDZKbMrfMwIWD6e5Hpgfm0xUq08iQIDAQAB\"</code></pre>\n</li>\n</ol>\n<h1 id=\"h_01J6W53E68G48ZDCAH1XV8MHY5\">Summary</h1>\n<p>This article provides a step-by-step guide on how to generate a DKIM key for a custom domain using Docker and OpenSSL, and how to add it to the Hurricane MTA server. It also provides instructions on how to test the DKIM setup using mail-tester.com and customervoice360.com.</p>\n<h2 id=\"h_01J6W53E68919R01S8HT808R6X\">FAQ</h2>\n<ol>\n<li>\n<strong>What is a DKIM key?</strong><br>DKIM (DomainKeys Identified Mail) is an email authentication method that allows the receiver to check if the email was actually sent by the domain it claims to be sent from and if the content was tampered with during transit.</li>\n<li>\n<strong>Who is responsible for adding the DKIM record to the DNS settings?</strong><br>The client who manages the domain is responsible for adding the DKIM record to their DNS settings.</li>\n<li>\n<strong>What is an SPF record?</strong><br>An SPF (Sender Policy Framework) record is a type of Domain Name Service (DNS) record that identifies which mail servers are permitted to send email on behalf of your domain.</li>\n</ol>",
    "user_segment_ids": [
        360000084973
    ]
}