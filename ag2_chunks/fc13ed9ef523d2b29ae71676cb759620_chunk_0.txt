<p><b>Original Confluence URL:</b> <a href="https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/1293680664">https://qbdocs.atlassian.net/wiki/spaces/IAM/pages/1293680664</a> - please cross-check the quality of the ZD article with the Confluence counterpart and remove this line before publishing the ZD article</p>

<h2>Table of Contents</h2>
<ul class="toc">
<ul>
<li><a href="#header-1">What happened?</a></li>
<ul>
<li><a href="#header-3">The V2.0 flow</a></li>
<li><a href="#header-4">The V1.0 flow</a></li>
<li><a href="#header-5">Result:</a></li>
</ul>
</ul>
</ul><p></p><h1 id="header-1">What happened?</h1><p>Intervista is using an Azure AD that should be federated via OpenID Connect with Okta.</p><p></p><p>Simply setting that up did not work. When trying to login we just got an error screen.</p><p>After checking the logs in Okta we could see that Okta was complaining about a missing username.</p><img src="https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716951782930" alt="debugging_case_intervista_1.PNG"><p></p><h2 id="header-3">The V2.0 flow</h2><p>Thus we tried to get the token Okta will retrieve manually. We created a Sign-In link to the external Azure AD manually. After logging in with our test-user at the external Azure AD Okta did not exchange the OIDC code of the response for a token. We used postman to get that token with the responded code.</p><p>We used a link like to login to the external Azure AD:</p><p><a href="https://login.microsoftonline.com/ce28fcc1-a19e-477b-8194-0b272d1e6bb2/oauth2/v2.0/authorize?state=cTN1UzRUM05WYWlqVEh1SmpGS2hSZ09uL2VxTlJCUEcyZzJFdTZTTlNPQ0QrSG9aY0dmTlcwK0t5Qk1XVU1WaQ&amp;client_id=735b77b3-0297-4d2e-9de5-a98591aa4dd8&amp;redirect_uri=https%3A%2F%2Faccess.questback.com%2Foauth2%2Fv1%2Fauthorize%2Fcallback&amp;response_type=code&amp;scope=email+openid+profile&amp;sso_reload=true#">https://login.microsoftonline.com/ce28fcc1-a19e-477b-8194-0b272d1e6bb2/oauth2/v2.0/authorize?state=cTN1UzRUM05WYWlqVEh1SmpGS2hSZ09uL2VxTlJCUEcyZzJFdTZTTlNPQ0QrSG9aY0dmTlcwK0t5Qk1XVU1WaQ&amp;client_id=735b77b3-0297-4d2e-9de5-a98591aa4dd8&amp;redirect_uri=https%3A%2F%2Faccess.questback.com%2Foauth2%2Fv1%2Fauthorize%2Fcallback&amp;response_type=code&amp;scope=email+openid+profile&amp;sso_reload=true#</a></p><p>We got the following response with the code in the URL we used to get the tokens:</p><img src="https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716951647762" alt="debugging_case_intervista_2.PNG"><p></p><p>In the response we saw that the neither the userinfo endpoint nor the Identity Token had enough information to get first name, last name and email of the user.</p><p>(Our own Azure AD at least has enough information in the userinfo endpoint)</p><p><ac:parameter ac:name="title">Screenshots missing</ac:parameter><ac:parameter ac:name="colour">Red</ac:parameter> </p><p></p><h2 id="header-4">The V1.0 flow</h2><p>After that we saw that we are using the v2.0 endpoints of the Azure AD. We then tried to do the same with the v1.0 endpoints of the Azure AD.</p><p>We used the steps above until getting the code for a token.</p><p>We used the following postman request to get the tokens.</p><img src="https://discoverxi-supportdesk.zendesk.com/hc/article_attachments/20716935850258" alt="debugging_case_intervista_3.PNG"><p>And got the following response as result (yes the tokens are cut):</p><pre><code class="language-json">{
    "token_type": "Bearer",
    "expires_in": "3599",
    "ext_expires_in": "3599",
    "expires_on": "1583932197",
    "access_token": "jHRsluyAcxHFz1ZHS9kJSE-6NVz61g74bemmIJo2FcTWV5P3Y