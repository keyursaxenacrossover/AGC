UPDATE drago SET gid=[group Id of team"delete_me"] WHERE oid IN (SELECT pid FROM backup_pid);</code></pre><ul>
<li><p>Check organisation and assigned projects via the GUI.</p></li>
<li><p>(Finally) delete organisation (and hopefully) all assigned teams ("delete_me"), users and projects via the GUI.</p></li>
</ul><h4 id="header-23">Delete mails from mail report that do not belong to the client's organisation</h4><ul><li><p>Find out how many mails there are that do not belong to the client's organisation (mails that were not already deleted by deleting the organisation)</p></li></ul><pre><code class="language-sql">SELECT count(mail_id) FROM mail_prot AS p LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '2') AND po.oid!=[organisation Id of client];
SELECT count(p.mail_id) FROM mail_prot AS p LEFT JOIN mail_text AS mt ON(p.text_hash=mt.hash) LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '1') AND po.oid!=[organisation Id of client];</code></pre><ul><li><p>To which origanisations do these mail IDs belong to? You can ignore these if they only belong to Questback</p></li></ul><pre><code class="language-sql">SELECT mail_id, po.oid FROM mail_prot AS p LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '2') AND po.oid!=[organisation Id of client];
SELECT p.mail_id, po.oid FROM mail_prot AS p LEFT JOIN mail_text AS mt ON(p.text_hash=mt.hash) LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid) WHERE (p.id_type &amp; '1') AND po.oid!=[organisation Id of client];</code></pre><ul><li><p>Delete found mails_ids that do not belong to client or Questback from mail_prot and mail_text</p></li></ul><pre><code class="language-sql">CREATE TABLE backup_mails (mail_id int NOT NULL, text_hash varbinary(32) NOT NULL);
INSERT INTO backup_mails (SELECT mail_id, text_hash FROM mail_prot AS p LEFT JOIN project AS pr ON(p.pid=pr.pid) JOIN project_org po ON(pr.pid=po.pid)  WHERE (p.id_type &amp; '2') AND po.oid!=[organisation Id of client] AND po.oid!=[Questback organisation id]);
DELETE FROM mail_prot WHERE mail_id IN (SELECT mail_id FROM backup_mails);
DELETE FROM mail_text WHERE hash IN (SELECT text_hash FROM backup_mails);</code></pre><hr><h2 id="header-26">Clone Data Voyager</h2><p>If a Data Voyager has been copied. This is how you adjust the copy.</p><p>Please mind that copied DVs are in an undefined status because we currently do not have any experience with</p><p>what effects missing/empty fastbit partitions have. The requester has to check the DV afterwards. If it is not functional, it has to be set up a new.</p><div class="expand-macro">
<h4 string="Checklist:"></h4>
<p>[] Check application.ini to see whether the correct database data and folders are set<br>[] Login to DV using the root account and add the database of the copied installation as a source.<br>[] Delete existing projects in DV<br>[] Add Data Voyager to Globis (using "helpersAddInstallationInGlobis" in the dv folder)<br>[] Create a new root password (using script dv/support/changeRootPw.php)<br>[] Add Data Voyager and root password to PasswordSafe?<br>[] adjust table "ehr_reporting_fastbit_partitions":<br>* Add the domain in column "client".<br>* Add the customer_path in column "product"</p>
</div>.oid!=[Questback organisation id]);
DELETE FROM mail_prot WHERE mail_id IN (SELECT mail_id FROM backup_mails);
DELETE FROM mail_text WHERE hash IN (SELECT text_hash FROM backup_mails);</code></pre><hr><h2 id="header-26">Clone Data Voyager</h2><p>If a Data Voyager has been copied. This is how you adjust the copy.</p><p>Please mind that copied DVs are in an undefined status because we currently do not have any experience with</p><p>what effects missing/empty fastbit partitions have. The requester has to check the DV afterwards. If it is not functional, it has to be set up a new.</p><div class="expand-macro">
<h4 string="Checklist:"></h4>
<p>[] Check application.ini to see whether the correct database data and folders are set<br>[] Login to DV using the root account and add the database of the copied installation as a source.<br>[] Delete existing projects in DV<br>[] Add Data Voyager to Globis (using "helpersAddInstallationInGlobis" in the dv folder)<br>[] Create a new root password (using script dv/support/changeRootPw.php)<br>[] Add Data Voyager and root password to PasswordSafe?<br>[] adjust table "ehr_reporting_fastbit_partitions":<br>* Add the domain in column "client".<br>* Add the customer_path in column "product"</p>
</div>